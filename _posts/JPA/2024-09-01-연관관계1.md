---
title: ì—°ê´€ ê´€ê³„ ë§¤í•‘ (1)
date: 2024-09-01
categories: [ JPA ]
tags: [ JPA, ORM, ë‹¨ë°©í–¥, ì–‘ë°©í–¥, ì—°ê´€ê´€ê³„ ]
image: assets/posts/jpa_logo.jpeg
---

## ğŸ¬ Intro

> ë‹¨ë°©í–¥, ì–‘ë°©í–¥ ì—°ê´€ ê´€ê³„ì— ëŒ€í•´ ì•Œì•„ë´…ì‹œë‹¤.

### âœ… ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„

ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„ëŠ” í•œìª½ ì—”í‹°í‹°ë§Œ ë‹¤ë¥¸ ì—”í‹°í‹°ë¥¼ ì°¸ì¡°í•˜ëŠ” ê´€ê³„ ì…ë‹ˆë‹¤. MemberëŠ” Teamì„ ì°¸ì¡°í•˜ê³  Teamì€ Memberë¥¼ ì°¸ì¡°í•˜ì§€ ì•ŠëŠ”ë‹¤ê³  í–ˆì„ë•Œ ì´ ê²½ìš°ë¥¼ ë‹¨ë°©í–¥ ê´€ê³„ë¼ê³  í•˜ëŠ”ê²ƒì´ì£ 
ë”°ë¼ì„œ DBìƒ Member í…Œì´ë¸”ì—ëŠ” Teamì˜ PKì˜ ê°’ì„ ì™¸ë˜í‚¤ë¡œ ë“¤ê³  ìˆìŠµë‹ˆë‹¤.

### âœ… ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„

ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ëŠ” ë‘ ì—”í‹°í‹°ê°€ ì„œë¡œë¥¼ ì°¸ì¡°í•˜ëŠ” ê´€ê³„ ì…ë‹ˆë‹¤. Memberì™€ Teamì´ ì„œë¡œ ì°¸ì¡°í•˜ê³  ìˆëŠ”ê²ƒ ì…ë‹ˆë‹¤. ì—¬ê¸°ì„œ ì£¼ì˜í•  ì ì€ ê°ì²´ ìƒì—ì„œ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì„ ì •í•˜ëŠ” ê²ƒ ì…ë‹ˆë‹¤.
DBìƒì—ëŠ” Member, Team í…Œì´ë¸” ì¤‘ í•œê³³ì—ë§Œ ì°¸ì¡°í•˜ëŠ” ìƒëŒ€ì˜ ì™¸ë˜í‚¤ë¥¼ ê°–ê³  ìˆê²Œ ë©ë‹ˆë‹¤. ë”°ë¼ì„œ DBê´€ì ì—ì„œëŠ” ë¬¸ì œê°€ ë˜ì§€ ì•Šì§€ë§Œ,
ê°ì²´ ê´€ì ì—ì„œëŠ” ë¬¸ì œê°€ ë°œìƒí•˜ê²Œ ë©ë‹ˆë‹¤. ë°”ë¡œ ì´ ì™¸ë˜í‚¤ë¥¼ ëˆ„ê°€ ë“¤ê³  ìˆê³  ê´€ë¦¬í• ê²ƒì¸ê°€ì— ëŒ€í•´ì„œ ë§ì´ì£ .

ë‹µì„ ë¨¼ì € ë§ì”€ë“œë¦¬ë©´ **_N:1 ì¤‘ Nìª½ì´ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì´ ë˜ì–´ì•¼ í•©ë‹ˆë‹¤._** ì¦‰, Teamì•„ë‹Œ Memberê°€ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì´ ë˜ì–´ì•¼í•˜ëŠ” ê²ƒì´ì£ 
ê·¸ ì´ìœ ëŠ” DBìƒ í…Œì´ë¸”ì˜ ìƒíƒœì™€ JPA ë™ì‘ë°©ì‹ ë•Œë¬¸ì…ë‹ˆë‹¤. DBìƒì—ëŠ” N:1ê´€ê³„ ì¤‘ Nì´ ì™¸ë˜í‚¤ë¥¼ ê´€ë¦¬í•˜ê²Œ ë©ë‹ˆë‹¤. ì´ê²ƒë§Œ ë³´ë”ë¼ë„ ì™¸ë˜í‚¤ë¥¼ ê°–ê³  ìˆëŠ” Nìª½ì´ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì´ ë˜ëŠ”ê²ƒì´ ìì—°ìŠ¤ëŸ½ìŠµë‹ˆë‹¤.

ë§Œì•½ ì™¸ë˜í‚¤ë¥¼ ê°–ê³  ìˆì§€ ì•ŠëŠ” 1ìª½ì´ ì—°ê´€ê´€ê³„ ì£¼ì¸ì´ ëœë‹¤ë©´ JPAëŠ” ì¡°ì¸ í…Œì´ë¸”ì„ ìƒì„±í•˜ê²Œ ë©ë‹ˆë‹¤. ë˜í•œ ë³µì¡í•œ ì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•˜ë©° ì´ëŠ” ì„±ëŠ¥ ì €í•˜ë¥¼ ì´ˆë˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì´ëŸ¬í•œ ì´ìœ  ë•Œë¬¸ì— N:1 ì¤‘ Nìª½ì´ ê°ì²´ ê´€ì ì—ì„œ ì—°ê´€ê´€ê³„ ì£¼ì¸ì´ ë˜ëŠ”ê²Œ ë§ëŠ”ê²ƒì´ì£ .

**_ë˜í•œ JPAëŠ” ì—°ê´€ê´€ê³„ ì£¼ì¸ì— ê´€ê³„ê°€ ì—…ë°ì´íŠ¸ë  ë•Œ DBì— ê´€ê³„ë¥¼ ë°˜ì˜í•˜ê²Œ ë©ë‹ˆë‹¤. ì¦‰, Memberì—ë‹¤ê°€ë§Œ Teamì„ ì„¸íŒ…í•´ë„ ë‘˜ ì‚¬ì´ì˜ ì—°ê´€ê´€ê³„ê°€ DBì— ë°˜ì˜ë˜ì§€ë§Œ,
Teamì—ë‹¤ê°€ë§Œ Memberë¥¼ ë°˜ì˜í•˜ê²Œ ë˜ë©´ ë‘˜ ì‚¬ì´ì˜ ì—°ê´€ê´€ê³„ê°€ DBì— ë°˜ì˜ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤._** ì¦‰, ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì´ ì•„ë‹Œ ìª½ì€ ì£¼ì¸ìª½ì„ ì½ê¸°ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.

### ğŸ“ ì˜ˆì œ

#### ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„

```java

@Entity
@Table
@NoArgsConstructor
@Data
public class Member {

  @Id
  @GeneratedValue(strategy = GenerationType.SEQUENCE)
  @Column(name = "member_id")
  private Long id;

  private String name;

  // Join Columnì„ ê¸°ì¤€ìœ¼ë¡œ Teamì˜ ê°ì²´ë¥¼ ì°¾ì•„ì˜¤ê²Œ ëœë‹¤.
  // ë§Œì•½ Member í…Œì´ë¸”ì— team_idê°€ null ì´ë©´ Team ê°ì²´ë„ nullì´ë‹¤.
  @ManyToOne(fetch = FetchType.LAZY)
  @JoinColumn(name = "team_id")
  private Team team;

  @Builder
  public Member(final Long id, final String name, final Team team) {
    this.id = id;
    this.name = name;
    this.team = team;
  }

}
```

```java

@Entity
@Table
@NoArgsConstructor
@Data
public class Team {

  @Id
  @GeneratedValue(strategy = GenerationType.SEQUENCE)
  @Column(name = "team_id")
  private Long id;

  private String name;

  @Builder
  public Team(final Long id, final String name) {

    this.id = id;
    this.name = name;
  }

}

```

- Memberì™€ Teamì€ N:1 ê´€ê³„ ì´ê³ , Memberë§Œ Teamì„ ì°¸ì¡°í•˜ëŠ” ë‹¨ë°©í–¥ ê´€ê³„ ì…ë‹ˆë‹¤.

```java

@DataJpaTest
@AutoConfigureTestDatabase(replace = AutoConfigureTestDatabase.Replace.NONE)
public class JpaTest1 {

  @Autowired
  private MemberRepository memberRepository;

  @Autowired
  private TeamRepository teamRepository;

  @Autowired
  private EntityManager em;

  @DisplayName("ë‹¨ë°©í–¥ ì—°ê´€ ê´€ê³„ í…ŒìŠ¤íŠ¸")
  @Test
  void jpaTest1() throws Exception {
    //given

    Team team = Team.builder()
      .name("í…ŒìŠ¤íŠ¸íŒ€1")
      .build();

    // ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ë“±ë¡
    Team savedTeam = teamRepository.save(team);

    Member member = Member.builder()
      .name("í…ŒìŠ¤íŠ¸ìœ ì €1")
      .team(savedTeam)
      .build();

    // ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ë“±ë¡
    Member savedMember = memberRepository.save(member);

    //when

    // Teamì€ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ë“±ë¡ë˜ì–´ ìˆìœ¼ë¯€ë¡œ, 1ì°¨ ìºì‹œì—ì„œ ê°€ì ¸ì˜´ SELECT ì¿¼ë¦¬ X
    Team getTeam = savedMember.getTeam();
    getTeam.setName("í…ŒìŠ¤íŠ¸íŒ€2");

    System.out.println("======= ì“°ê¸° ì§€ì—° =========");
    em.flush();

    //then
    assertThat(savedTeam.getName()).isEqualTo("í…ŒìŠ¤íŠ¸íŒ€2");
  }

}

```

- `@DataJpaTest`ëŠ” `@Transactional`ì„ ê°ì‹¸ê³  ìˆìŠµë‹ˆë‹¤.
- í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œ `@Transactional`ì€ í…ŒìŠ¤íŠ¸ê°€ ì¢…ë£Œ í›„ ë¡¤ë°±ì´ ë˜ê¸° ë•Œë¬¸ì— DBì— ë°˜ì˜ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
- Team ìƒì„±í•˜ê³  saveë¥¼ ì´ìš©í•˜ì—¬ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ë“±ë¡í•©ë‹ˆë‹¤.
- Memberë¥¼ ìƒì„±í•˜ê³  saveë¥¼ ì´ìš©í•˜ì—¬ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ë“±ë¡í•©ë‹ˆë‹¤. ì´ë•Œ Memberì— ë“±ë¡ë˜ëŠ” Teamì€ savedTeamì´ë¯€ë¡œ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ë“±ë¡ëœ ê°ì²´ ì…ë‹ˆë‹¤.
  ë”°ë¼ì„œ ì¶”ê°€ì ì¸ SELECT ì¿¼ë¦¬ê°€ ì‹¤í–‰ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
- ManyToOne ê´€ê³„ë¡œ Memberì— Teamì´ ì¡´ì¬í•˜ë¯€ë¡œ í•´ë‹¹ ê°ì²´ë¥¼ ê°€ì ¸ì™€ì„œ ë³€ê²½í•©ë‹ˆë‹¤. ì´ë•Œ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì €ì¥ëœ savedTeamê³¼ getTeamì€ ë™ì¼í•œ ê°ì²´ì…ë‹ˆë‹¤.
  ë”°ë¼ì„œ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ê´€ë¦¬í•˜ëŠ” ê°ì²´ì— ë³€ê²½ì´ ì¼ì–´ë‚¬ìœ¼ë¯€ë¡œ ë”í‹°ì²´í‚¹ì— ì˜í•´ì„œ UPDATE ì¿¼ë¦¬ê°€ ë°œìƒí•©ë‹ˆë‹¤.

```text
Hibernate: 
    create table member (
        member_id bigint not null,
        team_id bigint,
        name varchar(255),
        primary key (member_id)
    )
    
Hibernate: 
    create table team (
        team_id bigint not null,
        name varchar(255),
        primary key (team_id)
    )
Hibernate: 
    alter table if exists member 
       add constraint FKcjte2jn9pvo9ud2hyfgwcja0k 
       foreign key (team_id) 
       references team
```

![img.png](/assets/posts/img_1.png)

- ManyToOne ì—°ê´€ê´€ê³„ ë§¤í•‘ì— ì˜í•´ Memberìª½ í…Œì´ë¸”ì— Teamì˜ PKê°€ ì™¸ë˜í‚¤ë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.

```text
Hibernate: 
    select
        next value for team_seq
Hibernate: 
    select
        next value for member_seq
======= ì“°ê¸° ì§€ì—° =========
Hibernate: 
    insert 
    into
        team
        (name, team_id) 
    values
        (?, ?)
Hibernate: 
    insert 
    into
        member
        (name, team_id, member_id) 
    values
        (?, ?, ?)
Hibernate: 
    update
        team 
    set
        name=? 
    where
        team_id=?

```

- ì‹¤í–‰ëœ ì¿¼ë¦¬ë¥¼ em.flush()ë¥¼ í˜¸ì¶œí•˜ì—¬ í™•ì¸í•´ë´…ì‹œë‹¤.
- save 2ë²ˆ => INSERT ì¿¼ë¦¬ 2ë²ˆ, ë”í‹°ì²´í‚¹ 1ë²ˆ => UPDATE ì¿¼ë¦¬ 1ë²ˆì´ ì˜ ì‹¤í–‰ë˜ì—ˆìŠµë‹ˆë‹¤.
- ì—¬ê¸°ì„œ ì£¼ì˜ í•  ì ì€ í…ŒìŠ¤íŠ¸ í™˜ê²½ì´ ì•„ë‹ˆë¼ë©´ em.flush()ë¥¼ ì´ìš©í•´ì„œ ìˆ˜ë™ìœ¼ë¡œ DBì— ë°˜ì˜í•˜ëŠ”ì¼ì€ ê±°ì˜ ì—†ìŠµë‹ˆë‹¤.
- ë˜í•œ flush()ì— ì˜í•´ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ê°€ ìŒ“ì•„ë‘” ì¿¼ë¦¬ë¥¼ ëª¨ë‘ ì¶œë ¥í–ˆê¸°ë•Œë¬¸ì— UPDATE ì¿¼ë¦¬ê°€ ì¡´ì¬í•˜ì§€ë§Œ, ì‹¤ì œë¡œëŠ” ì»¤ë°‹ ì‹œì ì— ìµœì¢…ì ìœ¼ë¡œ ì„¤ì •ëœ ê°’ìœ¼ë¡œ INSERTë¬¸ì´
  í•œë²ˆë§Œ ì‹¤í–‰ë˜ê²Œ ë©ë‹ˆë‹¤. ì¦‰, "í…ŒìŠ¤íŠ¸íŒ€2"ë¡œ INSERTë¬¸ì´ í•œë²ˆë§Œ ì‹¤í–‰ë˜ê²Œ ë˜ëŠ”ê²ƒì´ì£ 

#### ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„

##### ì—°ê´€ê´€ê³„ ì£¼ì¸ì— ê´€ê³„ë¥¼ ì—…ë°ì´íŠ¸í•´ì•¼í•˜ëŠ” ì´ìœ 

```java

@DataJpaTest
@AutoConfigureTestDatabase(replace = AutoConfigureTestDatabase.Replace.NONE)
public class JpaTest2 {

  @Autowired
  private MemberRepository memberRepository;

  @Autowired
  private TeamRepository teamRepository;

  @Autowired
  private EntityManager em;

  @DisplayName("ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ í…ŒìŠ¤íŠ¸")
  @Test
  void jpaTest2() throws Exception {
    //given

    Team team = Team.builder()
      .name("í…ŒìŠ¤íŠ¸íŒ€1")
      .build();

    // ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ë“±ë¡, savedTeam ê³¼ teamì€ ë™ì¼í•œ ê°ì²´
    Team savedTeam = teamRepository.save(team);

    Member member = Member.builder()
      .name("í…ŒìŠ¤íŠ¸ìœ ì €1")
      .team(savedTeam)
      .build();

    // ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ë“±ë¡
    Member savedMember = memberRepository.save(member);

    System.out.println("========= ì“°ê¸° ì§€ì—° ============");
    em.flush();
    em.clear();
    System.out.println("==============================");

    // when
    System.out.println("========= SELECT =============");
    Team getTeam = teamRepository.findById(savedTeam.getId()).orElse(null);
    System.out.println("==============================");
    System.out.println("========== ì§€ì—° ë¡œë”© ===========");
    for (Member getMember : getTeam.getMembers()) {
      System.out.println(getMember.getName());
    }
    System.out.println("========== ì§€ì—° ë¡œë”© ===========");

    //then
  }
}

```

```text
Hibernate: 
    select
        next value for team_seq
Hibernate: 
    select
        next value for member_seq
========= ì“°ê¸° ì§€ì—° ============
Hibernate: 
    insert 
    into
        team
        (name, team_id) 
    values
        (?, ?)
Hibernate: 
    insert 
    into
        member
        (name, team_id, member_id) 
    values
        (?, ?, ?)
==============================
========= SELECT =============
Hibernate: 
    select
        t1_0.team_id,
        t1_0.name 
    from
        team t1_0 
    where
        t1_0.team_id=?
==============================
========== ì§€ì—° ë¡œë”© ===========
Hibernate: 
    select
        m1_0.team_id,
        m1_0.member_id,
        m1_0.name 
    from
        member m1_0 
    where
        m1_0.team_id=?
í…ŒìŠ¤íŠ¸ìœ ì €1
==============================
```

- em.flush()ëŠ” ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ìŒ“ì¸ ë‚´ìš©ë“¤ì„ DBì— ìˆ˜ë™ìœ¼ë¡œ ë°˜ì˜í•©ë‹ˆë‹¤.
- em.clear()ëŠ” ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ë¹„ì›ë‹ˆë‹¤.
- Teamì„ ìƒì„±í•˜ê³  Memberì— Teamì„ ì„¤ì •í•œë’¤ ë‘˜ì„ saveí•©ë‹ˆë‹¤. INSERT ì¿¼ë¦¬ê°€ 2ê°œ ìƒì„± ë©ë‹ˆë‹¤.
- ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì¸ Memberì— Teamì„ ì„¤ì •í–ˆê¸° ë•Œë¬¸ì— ë‘˜ ì‚¬ì´ì˜ ê´€ê³„ëŠ” DBì— ì˜ ë°˜ì˜ë©ë‹ˆë‹¤.
  ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ flush()ì™€ clear() í›„ ê°€ì ¸ì˜¨ Teamì˜ membersë¥¼ ì¡°íšŒí•´ë³´ë©´ ì˜ ë°˜ì˜ëë‹¤ëŠ”ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì£ 
- ê·¸ë ‡ë‹¤ë©´ Teamì— Memberë¥¼ ì„¸íŒ…í•˜ê³  Memberì— Teamì„ ì„¸íŒ…í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ì–´ë–»ê²Œ ë ê¹Œìš”??

```java

@DataJpaTest
@AutoConfigureTestDatabase(replace = AutoConfigureTestDatabase.Replace.NONE)
public class JpaTest2 {

  @Autowired
  private MemberRepository memberRepository;

  @Autowired
  private TeamRepository teamRepository;

  @Autowired
  private EntityManager em;

  @DisplayName("ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ í…ŒìŠ¤íŠ¸")
  @Test
  void jpaTest2() throws Exception {
    //given

    Team team = Team.builder()
      .name("í…ŒìŠ¤íŠ¸íŒ€1")
      .build();

    // ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ë“±ë¡, savedTeam ê³¼ teamì€ ë™ì¼í•œ ê°ì²´
    Team savedTeam = teamRepository.save(team);

    Member member = Member.builder()
      .name("í…ŒìŠ¤íŠ¸ìœ ì €1")
      .build();

    // ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ë“±ë¡
    Member savedMember = memberRepository.save(member);

    // Teamì— Memberë¥¼ ì¶”ê°€
    savedTeam.getMembers().add(savedMember);

    System.out.println("========= ì“°ê¸° ì§€ì—° ============");
    em.flush();
    em.clear();
    System.out.println("==============================");

    // when
    System.out.println("========= SELECT =============");
    Team getTeam = teamRepository.findById(savedTeam.getId()).orElse(null);
    System.out.println("==============================");
    System.out.println("========== ì§€ì—° ë¡œë”© ===========");
    for (Member getMember : getTeam.getMembers()) {
      System.out.println(getMember.getName());
    }
    System.out.println("==============================");

    //then
  }
}
```

```text
Hibernate: 
    select
        next value for team_seq
Hibernate: 
    select
        next value for member_seq
========= ì“°ê¸° ì§€ì—° ============
Hibernate: 
    insert 
    into
        team
        (name, team_id) 
    values
        (?, ?)
Hibernate: 
    insert 
    into
        member
        (name, team_id, member_id) 
    values
        (?, ?, ?)
==============================
========= SELECT =============
Hibernate: 
    select
        t1_0.team_id,
        t1_0.name 
    from
        team t1_0 
    where
        t1_0.team_id=?
==============================
========== ì§€ì—° ë¡œë”© ===========
Hibernate: 
    select
        m1_0.team_id,
        m1_0.member_id,
        m1_0.name 
    from
        member m1_0 
    where
        m1_0.team_id=?
==============================

```

- Teamì— Memberë¥¼ ì¶”ê°€í–ˆëŠ”ë° í…ŒìŠ¤íŠ¸ìœ ì €1ì´ ì¶œë ¤ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.
- ê·¸ ì´ìœ ëŠ” **_JPAëŠ” ì—°ê´€ê´€ê³„ ì£¼ì¸ì— ê´€ê³„ê°€ ì—…ë°ì´íŠ¸ë  ë•Œ DBì— ê´€ê³„ë¥¼ ë°˜ì˜í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤._**

##### ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì„œë“œë¥¼ ì‚¬ìš©í•´ì•¼í•˜ëŠ” ì´ìœ 

```java

@DataJpaTest
@AutoConfigureTestDatabase(replace = AutoConfigureTestDatabase.Replace.NONE)
public class JpaTest2 {

  @Autowired
  private MemberRepository memberRepository;

  @Autowired
  private TeamRepository teamRepository;

  @Autowired
  private EntityManager em;

  @DisplayName("ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ í…ŒìŠ¤íŠ¸")
  @Test
  void jpaTest2() throws Exception {
    //given

    Team team = Team.builder()
      .name("í…ŒìŠ¤íŠ¸íŒ€1")
      .build();

    // ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ë“±ë¡, savedTeam ê³¼ teamì€ ë™ì¼í•œ ê°ì²´
    Team savedTeam = teamRepository.save(team);

    Member member = Member.builder()
      .team(team)
      .name("í…ŒìŠ¤íŠ¸ìœ ì €1")
      .build();

    // ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ë“±ë¡
    Member savedMember = memberRepository.save(member);

    System.out.println("========= ì“°ê¸° ì§€ì—° ============");
    // em.flush();
    // em.clear();

    // when
    System.out.println("========= SELECT =============");
    Team getTeam = teamRepository.findById(savedTeam.getId()).orElse(null);
    System.out.println("==============================");
    System.out.println("========== ì§€ì—° ë¡œë”© ===========");
    for (Member getMember : getTeam.getMembers()) {
      System.out.println(getMember.getName());
    }
    System.out.println("==============================");

    //then
  }
}
```

```text
Hibernate: 
    select
        next value for team_seq
Hibernate: 
    select
        next value for member_seq
========= ì“°ê¸° ì§€ì—° ============
========= SELECT =============
==============================
========== ì§€ì—° ë¡œë”© ===========
==============================

```

- flush(), clear()ë¥¼ ì£¼ì„ì²˜ë¦¬í•˜ì—¬ DB ë°˜ì˜ê³¼ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ë¹„ìš°ëŠ” ì‘ì—…ì„ ì·¨ì†Œí•˜ì˜€ìŠµë‹ˆë‹¤.
- findByIdë¡œ ê°€ì ¸ì˜¤ëŠ” Teamì€ 1ì°¨ ìºì‹œì— ì €ì¥ëœ ë†ˆì´ë¯€ë¡œ SELECT ì¿¼ë¦¬ê°€ ë‚˜ê°€ì§€ ì•ŠìŠµë‹ˆë‹¤.
- Memberì— Teamì„ ì„¤ì •í–ˆì§€ë§Œ Teamì—ëŠ” Memberê°€ ì—†ìŠµë‹ˆë‹¤. ì™œ ê·¸ëŸ´ê¹Œìš”??
- í˜„ì¬ Memberì™€ Teamì€ 1ì°¨ ìºì‹œì— ìˆëŠ” ìˆœìˆ˜ ê°ì²´ ìƒíƒœì…ë‹ˆë‹¤. ë”°ë¼ì„œ Teamì˜ members ì»¬ë ‰ì…˜ì— memberë¥¼ ì¶”ê°€í•´ì£¼ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì—
  memberê°€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ê²ƒì…ë‹ˆë‹¤.
- ë§Œì•½ flush()ë¥¼ í†µí•´ DBì— ë‘˜ì˜ ê´€ê³„ë¥¼ ë°˜ì˜ë˜ë©´, Teamì˜ membersê°€ ì‚¬ìš©ë˜ëŠ” ì‹œì ì— ì™¸ë˜í‚¤ë¥¼ ì´ìš©í•´ memberë¥¼ ì˜ ê°€ì ¸ì˜¤ê²Œ ë©ë‹ˆë‹¤.
- **_JPAì™€ ê°™ì€ ORMì€ DBì˜ ë°ì´í„°ë¥¼ ê°ì²´ë¡œ ë‹¤ë£¨ëŠ”ê²ƒì´ ëª©í‘œì´ê¸° ë•Œë¬¸ì— ê°ì²´ ìƒíƒœì™€ DB ë°ì´í„°ëŠ” ë¬´ì¡°ê±´ ì¼ì¹˜í•´ì•¼í•©ë‹ˆë‹¤._**
- ë”°ë¼ì„œ ì—°ê´€ê´€ê³„ ë©”ì„œë“œë¥¼ í†µí•´ ìˆœìˆ˜ ê°ì²´ ìƒíƒœì¸ Member, Teamì—ê²Œ ë‘˜ì˜ ê´€ê³„ë¥¼ ì„¤ì •í•´ì¤˜ì•¼í•©ë‹ˆë‹¤.

```java

@DataJpaTest
@AutoConfigureTestDatabase(replace = AutoConfigureTestDatabase.Replace.NONE)
public class JpaTest2 {

  @Autowired
  private MemberRepository memberRepository;

  @Autowired
  private TeamRepository teamRepository;

  @Autowired
  private EntityManager em;

  @DisplayName("ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ í…ŒìŠ¤íŠ¸")
  @Test
  void jpaTest2() throws Exception {
    //given

    Team team = Team.builder()
      .name("í…ŒìŠ¤íŠ¸íŒ€1")
      .build();

    // ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ë“±ë¡, savedTeam ê³¼ teamì€ ë™ì¼í•œ ê°ì²´
    Team savedTeam = teamRepository.save(team);

    Member member = Member.builder()
      .name("í…ŒìŠ¤íŠ¸ìœ ì €1")
      .build();

    System.out.println("========= ì“°ê¸° ì§€ì—° ============");
    em.flush();
    em.clear();
    System.out.println("==============================");

    // when
    System.out.println("========= SELECT =============");
    Team getTeam = teamRepository.findById(savedTeam.getId()).orElse(null);
    System.out.println("==============================");
    System.out.println("========== ì§€ì—° ë¡œë”© ===========");
    for (Member getMember : getTeam.getMembers()) {
      System.out.println(getMember.getName());
    }
    System.out.println("==============================");

    //then
  }
}
```

```text
Hibernate: 
    select
        next value for team_seq
Hibernate: 
    select
        next value for member_seq
========= ì“°ê¸° ì§€ì—° ============
========= SELECT =============
==============================
========== ì§€ì—° ë¡œë”© ===========
í…ŒìŠ¤íŠ¸ìœ ì €1
==============================
```

- ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì„œë“œë¡œ ë‘˜ ì‚¬ì´ì˜ ê´€ê³„ë¥¼ ì„¤ì •í–ˆìœ¼ë¯€ë¡œ teamì— memberê°€ ì˜ì¶”ê°€ëœê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.


## âœ¨ Summary

#### ì—°ê´€ê´€ê³„ ì£¼ì¸
- ì™¸ë˜í‚¤ë¥¼ ê°€ì§€ê³  ìˆëŠ”ìª½ì„ ì—°ê´€ê´€ê³„ ì£¼ì¸ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.

#### ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„

- í•œìª½ ì—”í‹°í‹°ë§Œ ë‹¤ë¥¸ ì—”í‹°í‹°ë¥¼ ì°¸ì¡°í•˜ëŠ” ê´€ê³„ ì…ë‹ˆë‹¤.
- DBì—ì„œëŠ” Nìª½ì´ ì™¸ë˜í‚¤ë¥¼ ê°–ê²Œ ë©ë‹ˆë‹¤.

#### ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„

- ë‘ ì—”í‹°í‹°ê°€ ì„œë¡œë¥¼ ì°¸ì¡°í•˜ëŠ” ê´€ê³„ ì…ë‹ˆë‹¤.
- N:1 ê´€ê³„ì—ì„œ Nìª½ì´ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì´ ë˜ì–´ì•¼í•©ë‹ˆë‹¤.
- JPAëŠ” ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì— ê´€ê³„ê°€ ì—…ë°ì´íŠ¸ ëì„ë•Œë§Œ ë‘ ì‚¬ì´ì˜ ê´€ê³„ë¥¼ DBì— ë°˜ì˜í•©ë‹ˆë‹¤. ì¦‰, Nìª½ì— 1ì˜ ì •ë³´ë¥¼ ì„¤ì •í•´ì•¼í•©ë‹ˆë‹¤.

#### ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì„œë“œì˜ í•„ìš”ì„±

- ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ì—ì„œ ì—°ê´€ê´€ê³„ ì£¼ì¸ì—ë§Œ ê´€ê³„ë¥¼ ì„¤ì •í•˜ë©´, ìˆœìˆ˜ ê°ì²´ì—ì„œëŠ” ì£¼ì¸ì´ ì•„ë‹Œìª½ì— ê´€ê³„ê°€ ë°˜ì˜ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
- ë”°ë¼ì„œ ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì„œë“œë¥¼ ì‚¬ìš©í•´ ì–‘ìª½ ì—”í‹°í‹°ì— ê´€ê³„ë¥¼ ì„¤ì •í•˜ì—¬, ê°ì²´ ìƒíƒœì™€ DB ìƒíƒœë¥¼ ì¼ì¹˜ì‹œì¼œì•¼í•©ë‹ˆë‹¤.

#### ETC

- @DataJpaTest ì• ë…¸í…Œì´ì…˜ì€ @Transactionalì„ ê°ì‹¸ê³  ìˆê¸°ë•Œë¬¸ì— í…ŒìŠ¤íŠ¸ ì™„ë£Œí›„ ìë™ìœ¼ë¡œ ë¡¤ë°±ë©ë‹ˆë‹¤.

