---
title: ì—°ê´€ ê´€ê³„ ë§¤í•‘ (3)
date: 2024-08-03
categories: [ JPA ]
tags: [ JPA, ORM, ë‹¨ë°©í–¥, ì–‘ë°©í–¥, ì—°ê´€ê´€ê³„ ]
image: assets/posts/jpa_logo.jpeg
---

## ğŸ¬ Intro
> @ManyToManyì— ëŒ€í•´ ì•Œì•„ë´…ì‹œë‹¤.

### âœ… @ManyToMany
DBëŠ” ë‹¤ëŒ€ë‹¤ ê°œë…ì´ ì—†ê¸° ë•Œë¬¸ì— @ManyToManyë¥¼ ì‚¬ìš©í•  ê²½ìš° JPAëŠ” ì¡°ì¸í…Œì´ë¸”ì„ ìë™ìœ¼ë¡œ ìƒì„±í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ë‹¤ëŒ€ë‹¤ ê´€ê³„ê°€ í•„ìš”í• ê²½ìš°
@ManyToManyë¥¼ ì‚¬ìš©í•˜ê¸° ë³´ë‹¤ëŠ” ì¤‘ê°„ í…Œì´ë¸”ì„ ë‘ì–´ì„œ 1:N, N:1 ê´€ê³„ë¡œ í’€ì–´ë‚´ì•¼í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ì—¬ëŸ¬ ìƒí’ˆ(ì±…)ì„ ì£¼ë¬¸ì„ í•  ìˆ˜ ìˆì„ê²½ìš° ì£¼ë¬¸ì€ ìƒí’ˆ(ì±…)ì„ ì—¬ëŸ¬ê°œ ê°€ì§ˆ ìˆ˜ ìˆê³ ,
ìƒí’ˆ(ì±…) ì—­ì‹œ ì£¼ë¬¸ì´ ì—¬ëŸ¬ë²ˆ ë˜ê¸° ë•Œë¬¸ì— ì£¼ë¬¸ì„ ì—¬ëŸ¬ê°œ ê°€ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ê²½ìš° ì£¼ë¬¸ìƒí’ˆì´ë¼ëŠ” ì¤‘ê°„ í…Œì´ë¸”ì„ ë‘ì–´ì„œ ì´ ê´€ê³„ë¥¼ í’€ì–´ë‚´ì•¼í•©ë‹ˆë‹¤. 


### ğŸ“ ì˜ˆì œ

![img_1.png](/assets/posts/img_7.png){: .center width="400" height="300"}



```java
@Entity
@Table
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@Data
public class Card {

	@Id
	@GeneratedValue(strategy = GenerationType.IDENTITY)
	private Long id;

	private String number;

	@OneToOne(mappedBy = "card", fetch = FetchType.LAZY)
	private Customer customer;

	@Builder
	public Card(final Long id, final String number, final Customer customer) {
		this.id = id;
		this.number = number;
		this.customer = customer;
	}


	// ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì„œë“œ
	public void updateCustomer(final Customer customer) {
		customer.setCard(this);
		this.customer = customer;
	}
}
```

```java
@Entity
@Table
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@Data
public class Customer {

	@Id
	@GeneratedValue(strategy = GenerationType.IDENTITY)
	private Long id;

	private String name;

	@OneToOne(fetch = FetchType.LAZY)
	@JoinColumn(name = "card_id")
	private Card card;

	@Builder
	public Customer(final Long id, final String name, final Card card) {
		this.card = card;
		this.id = id;
		this.name = name;
	}
}
```

```java
@Entity
@Table
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@Data
public class Book {

	@Id
	@GeneratedValue(strategy = GenerationType.IDENTITY)
	private Long id;

	private String title;

	private String author;

	@ManyToOne
	@JoinColumn(name = "book_store_id")
	private BookStore bookStore;

	@Builder
	public Book(final Long id, final String title, final String author) {
		this.id = id;
		this.title = title;
		this.author = author;
	}

}
```

```java
@Entity
@Table
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@Data
public class BookStore {

	@Id
	@GeneratedValue(strategy = GenerationType.IDENTITY)
	private Long id;

	private String name;
	@Builder
	public BookStore(final Long id, final String name) {
		this.id = id;
		this.name = name;
	}


}

```

```java
@Entity
@Table
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@Data
public class Orders {

	@Id
	@GeneratedValue(strategy = GenerationType.IDENTITY)
	private Long id;

	@ManyToOne
	@JoinColumn(name = "customer_id")
	private Customer customer;

	@OneToMany(mappedBy = "orders")
	private List<OrderBook> orderBooks = new ArrayList<>();

	@Enumerated(value = EnumType.STRING)
	private OrderStatus status;

	public void addOrderBook(final OrderBook orderBook) {
		orderBook.setOrders(this);
		this.orderBooks.add(orderBook);
	}

	@Builder
	public Orders(final Customer customer) {
		this.customer = customer;
	}


}
```

```java
@Entity
@Table
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@Data
public class OrderBook {

	@Id
	@GeneratedValue(strategy = GenerationType.IDENTITY)
	private Long id;

	@ManyToOne
	@JoinColumn(name = "orders_id")
	private Orders orders;

	@ManyToOne
	@JoinColumn(name = "book_id")
	private Book book;

	private int quantity;

}
```

```java
package com.example.jparemind1.domain;

public enum OrderStatus {

	PENDING,       // ì£¼ë¬¸ ì ‘ìˆ˜ ëŒ€ê¸° ì¤‘
	CONFIRMED,     // ì£¼ë¬¸ í™•ì •
	CANCELED,      // ì£¼ë¬¸ ì·¨ì†Œ
	RETURNED;      // ë°˜í’ˆ


}
```

- ê³ ê°ì€ í•˜ë‚˜ì˜ ì¹´ë“œë§Œ ì†Œì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ Customerì™€ CardëŠ” 1:1 ë‹¨ë°©í–¥ ê´€ê³„ ì…ë‹ˆë‹¤. ì™¸ë˜í‚¤ëŠ” Customerì— ì¡´ì¬í•˜ê³  ì—°ê´€ê´€ê³„ ì£¼ì¸ì…ë‹ˆë‹¤.
  ë§Œì•½ Cardê°ì²´ì—ì„œ Custmomerì— ì •ë³´ë¥¼ ì¡°íšŒí•  ì¼ì´ ë§ë‹¤ë©´ ì–‘ë°©í–¥ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
- Book ê³¼ BookStoreëŠ” N:1 ë‹¨ë°©í–¥ ê´€ê³„ ì…ë‹ˆë‹¤. Bookì´ Nì´ë¯€ë¡œ ì™¸ë˜í‚¤ëŠ” Bookì— ì¡´ì¬í•˜ë©° ì—°ê´€ê´€ê³„ ì£¼ì¸ì…ë‹ˆë‹¤. 
- í•˜ë‚˜ì˜ ì£¼ë¬¸ì€ ì—¬ëŸ¬ì„ ì£¼ë¬¸í•  ìˆ˜ ìˆê³  ì±… ì—­ì‹œ ì—¬ëŸ¬ë²ˆ ì£¼ë¬¸ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ Ordersì™€ Bookì€ N:N ê´€ê³„ ì…ë‹ˆë‹¤.  OrderBook ì´ë¼ëŠ” ì¤‘ê°„ í…Œì´ë¸”ì„ ë‘ì–´ ì´ë¥¼ 1:N N:1ë¡œ í’€ì–´ëƒ…ë‹ˆë‹¤.
- Ordersì™€ OrderBook 1:N ì–‘ë°©í–¥ ê´€ê³„ ì…ë‹ˆë‹¤. Orders ì—ì„œ ì£¼ë¬¸ ì±…ë“¤ì„ ì¡°íšŒí•˜ëŠ” ì¼ì´ ë§ì•„ Orders ê°ì²´ì—ì„œë„ OrderBook ê°ì²´ë¥¼ ì¡°íšŒ í•  ìˆ˜ ìˆê²Œë” ì–‘ë°©í–¥ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
  Nìª½ì¸ OrderBookì— ì™¸ë˜í‚¤ê°€ ì¡´ì¬í•˜ê³  ì—°ê´€ê´€ê³„ ì£¼ì¸ì…ë‹ˆë‹¤.
- OrderBookê³¼ Bookì€ N:1 ë‹¨ë°©í–¥ ê´€ê³„ì…ë‹ˆë‹¤. Book ìª½ì—ì„œ OrderBookì„ ì¡°íšŒí•  ì¼ì´ ê±°ì˜ ì—†ì–´ ë‹¨ë°©í–¥ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
  Nìª½ì¸ OrderBookì— ì™¸ë˜í‚¤ê°€ ì¡´ì¬í•˜ê³  ì—°ê´€ê´€ê³„ ì£¼ì¸ì…ë‹ˆë‹¤.


## âœ¨ Summary
- @ManyToManyëŠ” N:N ê´€ê³„ì´ë©° DBìƒì—ëŠ” ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ì‚¬ìš©ì„ ì§€ì–‘í•˜ê³  ì¤‘ê°„ í…Œì´ë¸”ì„ ë‘ì–´ì„œ 1:N N:1ë¡œ í’€ì–´ë‚´ì•¼ í•©ë‹ˆë‹¤.
