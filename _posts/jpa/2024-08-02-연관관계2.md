---
title: ì—°ê´€ ê´€ê³„ ë§¤í•‘ (2)
date: 2024-08-02
categories: [ JPA ]
tags: [ JPA, ORM, ë‹¨ë°©í–¥, ì–‘ë°©í–¥, ì—°ê´€ê´€ê³„ ]
image: assets/posts/jpa_logo.jpeg
---

## ğŸ¬ Intro
> ì—°ê´€ ê´€ê³„ì˜ ì¢…ë¥˜ë¥¼ ì•Œì•„ë´…ì‹œë‹¤.

### âœ… @ManyToOne
JPA ì—°ê´€ê´€ê³„ì—ì„œ ê°€ì¥ ë§ì´ ì‚¬ìš©í•˜ê³  í•œ ê°ì²´ê°€ ì—¬ëŸ¬ ê°ì²´ì™€ ì—°ê´€ë  ìˆ˜ ìˆëŠ” ê´€ê³„ì…ë‹ˆë‹¤. ë³´í†µ ë¶€ëª¨-ìì‹ ê´€ê³„ì—ì„œ ë¶€ëª¨ê°€ ì—¬ëŸ¬ ìì‹ì„ ê°€ì§ˆìˆ˜ ìˆëŠ” ê²½ìš°ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.
ì˜ˆë¡œ í•˜ë‚˜ì˜ BookStoreëŠ” ì—¬ëŸ¬ Bookì„ í¬í•¨í•  ìˆ˜ ìˆê³ , ê° Bookì€ í•˜ë‚˜ì˜ BookStoreì—ë§Œ ì†í•  ìˆ˜ ìˆëŠ” ê²½ìš°ê°€ @ManyToOne ê´€ê³„ì…ë‹ˆë‹¤. 
DB ìƒì—ëŠ” Many ìª½ì¸ Bookì— BookStoreì˜ ì™¸ë˜í‚¤ê°€ ì¡´ì¬í•˜ë©°, ê°ì²´ ìƒì—ì„œ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì€ Manyìª½ì¸ Bookì´ ë©ë‹ˆë‹¤.

ë˜í•œ @ManyToOneì˜ ê²½ìš° @JoinColumnìœ¼ë¡œ ì™¸ë˜í‚¤ë¥¼ ì„ ì–¸í•˜ì§€ ì•Šì•„ë„ JPAëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ìì‹ ì—”í‹°í‹°ì— ë¶€ëª¨ ì—”í‹°í‹°ë¥¼ ì°¸ì¡°í•˜ëŠ” ì™¸ë˜ í‚¤ ì»¬ëŸ¼ì„ ìë™ìœ¼ë¡œ ìƒì„±í•©ë‹ˆë‹¤.

### âœ… @OneToMany
ë³´í†µ @ManyToOne ì—°ê´€ê´€ê³„ ì‹œ ì–‘ë°©í–¥ì„ ìœ„í•´ ì‚¬ìš©í•˜ëŠ” ì• ë…¸í…Œì´ì…˜ì…ë‹ˆë‹¤. @OneToManyë¥¼ ë‹¨ë°©í–¥ìœ¼ë¡œ ì‚¬ìš©í•œë‹¤ë©´ ì™¸ë˜í‚¤ë¥¼ Oneìª½ì—ì„œ ê´€ë¦¬í•˜ê²Œ ë©ë‹ˆë‹¤.(ì£¼ì¸ì€ ì—¬ì „íˆ Manyìª½)
ì˜ˆë¥¼ ë“¤ì–´ Book ê³¼ BookStoreê°€ N:1ì´ë¼ë©´ Book ìª½ì— BookStoreì˜ ì™¸ë˜í‚¤ê°€ ì¡´ì¬í•˜ê²Œ ë©ë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ë¥¼ ê°ì²´ìƒì—ì„œ @OneToManyë¥¼ ì´ìš©í•˜ì—¬ BookStoreì—ì„œ
ì´ ì™¸ë˜í‚¤ë¥¼ ê´€ë¦¬í•˜ê²Œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ë ‡ê²Œ ë˜ë©´ BookStoreì— Bookì„ ì¶”ê°€í• ë•Œë§ˆë‹¤ Bookìª½ì˜ ì™¸ë˜í‚¤ë¥¼ ì—…ë°ì´íŠ¸í•´ì¤˜ì•¼í•˜ëŠ” ì¿¼ë¦¬ê°€ í•„ìš”í•˜ê²Œ ë©ë‹ˆë‹¤. ì´ëŸ¬í•œ ì´ìœ ë¡œ
@OneToMany ë‹¨ë°©í–¥ ê´€ê³„ëŠ” ì˜ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. 

@OneToManyì˜ ê²½ìš° @JoinColumnìœ¼ë¡œ ì™¸ë˜í‚¤ë¥¼ ì„ ì–¸í•˜ì§€ ì•Šìœ¼ë©´ JPAëŠ” ë‘˜ ì‚¬ì´ì˜ ê´€ê³„ë¥¼ ê´€ë¦¬í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— ì¡°ì¸ í…Œì´ë¸”ì„ ìë™ìœ¼ë¡œ ìƒì„±í•˜ê²Œ ë©ë‹ˆë‹¤.

### âœ… @OneToOne
ë‘ ê°ì²´ì˜ 1:1 ê´¸ê³„ì…ë‹ˆë‹¤. ì˜ˆë¥¼ë“¤ì–´ 1ëª…ì˜ ê³ ê°ì€ 1ê°œì˜ ì¹´ë“œë§Œ ì†Œì§€í•  ìˆ˜ ìˆëŠ” ê²½ìš°ì…ë‹ˆë‹¤. 
ë‹¨ë°©í–¥, ì–‘ë°©í–¥ ëª¨ë‘ ê°€ëŠ¥í•©ë‹ˆë‹¤. @OneToOneì€ ì™¸ë˜í‚¤ê°€ ì—†ëŠ” ìª½ì˜ ê°ì²´ê°€ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì´ ë  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
ë”°ë¼ì„œ ë§Œì•½ ì¹´ë“œìª½ì— ê³ ê°ì˜ ì™¸ë˜í‚¤ê°€ ìˆëŠ”ë° ê°ì²´ ìƒì—ì„œ ê³ ê°ì„ ì´ìš©í•´ì„œ ì¹´ë“œë¥¼ ì²˜ë¦¬í•´ì•¼í•  ë¡œì§ì´ ë§ë‹¤ë©´ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì€ ì¹´ë“œë¡œ ë‘ê³ 
ê³ ê°ìª½ì„ ì–‘ë°©í–¥ìœ¼ë¡œ ì„¤ì •í•˜ì—¬ ì²˜ë¦¬í•´ì•¼ ë©ë‹ˆë‹¤.

í•˜ì§€ë§Œ ì´ ê²½ìš°ì—ëŠ” ê³ ê°ì„ ì¡°íšŒí• ë•Œ ì§€ì—°ë¡œë”©ì´ë¼ í•˜ë”ë¼ë„ ê³ ê°ì´ ì¹´ë“œë¥¼ ì†Œì§€í•˜ê³  ìˆì§€ ì•Šìœ¼ë©´ í”„ë¡ì‹œ ê°ì²´ì— nullì„ ë„£ì–´ì•¼ í•¨ìœ¼ë¡œ ì¹´ë“œ í…Œì´ë¸”ì„ í•„ìˆ˜ë¡œ ì¡°íšŒí•˜ê²Œ ë©ë‹ˆë‹¤.
ì¦‰, ì¦‰ì‹œë¡œë”©ì´ ê°•ì œê°€ ë©ë‹ˆë‹¤.

### âœ… @ManyToMany
DBëŠ” ë‹¤ëŒ€ë‹¤ ê°œë…ì´ ì—†ê¸° ë•Œë¬¸ì— @ManyToManyë¥¼ ì‚¬ìš©í•  ê²½ìš° JPAëŠ” ì¡°ì¸í…Œì´ë¸”ì„ ìë™ìœ¼ë¡œ ìƒì„±í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ë‹¤ëŒ€ë‹¤ ê´€ê³„ê°€ í•„ìš”í• ê²½ìš°
@ManyToManyë¥¼ ì‚¬ìš©í•˜ê¸° ë³´ë‹¤ëŠ” ì¤‘ê°„ í…Œì´ë¸”ì„ ë‘ì–´ì„œ 1:N, N:1 ê´€ê³„ë¡œ í’€ì–´ë‚´ì•¼í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ì—¬ëŸ¬ ìƒí’ˆì„ ì£¼ë¬¸ì„ í•  ìˆ˜ ìˆì„ê²½ìš° ì£¼ë¬¸ì€ ìƒí’ˆì„ ì—¬ëŸ¬ê°œ ê°€ì§ˆ ìˆ˜ ìˆê³ ,
ìƒí’ˆ ì—­ì‹œ ì£¼ë¬¸ì´ ì—¬ëŸ¬ë²ˆ ë˜ê¸° ë•Œë¬¸ì— ì£¼ë¬¸ì„ ì—¬ëŸ¬ê°œ ê°€ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ê²½ìš° ì£¼ë¬¸ìƒí’ˆì´ë¼ëŠ” ì¤‘ê°„ í…Œì´ë¸”ì„ ë‘ì–´ì„œ ì´ ê´€ê³„ë¥¼ í’€ì–´ë‚´ì•¼í•©ë‹ˆë‹¤. 


### ğŸ“ ì˜ˆì œ

#### @ManyToOne

_Book (Many)ì´ ì™¸ë˜í‚¤ë¥¼ ê°€ì§€ê³  ìˆìœ¼ë¯€ë¡œ ì—°ê´€ê´€ê³„ ì£¼ì¸ì´ë‹¤._

![img.png](/assets/posts/img_6.png)

##### ë‹¨ë°©í–¥
```java
@Entity
@Table
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@Data
public class Book {

  @Id
  @GeneratedValue(strategy = GenerationType.IDENTITY)
  private Long id;

  private String title;

  private String author;

  @ManyToOne
  @JoinColumn(name = "book_store_id")
  private BookStore bookStore;

  @Builder
  public Book(final Long id, final String title, final String author) {
    this.id = id;
    this.title = title;
    this.author = author;
  }

}


@Entity
@Table
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@Data
public class BookStore {

  @Id
  @GeneratedValue(strategy = GenerationType.IDENTITY)
  private Long id;

  private String name;

}
```
- ë‹¨ë°©í–¥ì´ë¯€ë¡œ BookStoreê°ì²´ì—ì„œëŠ” Bookì„ ì½ì§€ ëª»í•©ë‹ˆë‹¤.


##### ì–‘ë°©í–¥
```java
@Entity
@Table
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@Data
public class BookStore {

  @Id
  @GeneratedValue(strategy = GenerationType.IDENTITY)
  private Long id;

  private String name;
  
  @OneToMany(mappedBy = "bookStore", cascade = CascadeType.ALL, orphanRemoval = true)
  private Set<Book> books = new HashSet<>();


  @Builder
  public BookStore(final Long id, final String name) {
    this.id = id;
    this.name = name;
  }

  public void addBook(final Book book) {
    this.books.add(book);
  }

}

```
- ì–‘ë°©í–¥ì´ë¯€ë¡œ BookStoreì—ì„œ Bookê°ì²´ë¥¼ ì½ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- Book, BookStore ìƒì„±ì‹œ ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ DBì™€ ê°ì²´ ì‚¬ì´ì˜ ë°ì´í„° êµ¬ì¡°ë¥¼ ì¼ì¹˜ ì‹œì¼œ ì¤ë‹ˆë‹¤.

#### @OneToMany

_ì—°ê´€ê´€ê³„ ì£¼ì¸ì€ Book(Many) ì´ì§€ë§Œ ì™¸ë˜í‚¤ë¥¼ BookStoreê°€ ê´€ë¦¬_

##### ë‹¨ë°©í–¥

```java
@Entity
@Table
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@Data
public class Book {

  @Id
  @GeneratedValue(strategy = GenerationType.IDENTITY)
  private Long id;

  private String title;

  private String author;

  @Builder
  public Book(final Long id, final String title, final String author) {
    this.id = id;
    this.title = title;
    this.author = author;
  }

}


@Entity
@Table
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@Data
public class BookStore {

  @Id
  @GeneratedValue(strategy = GenerationType.IDENTITY)
  private Long id;

  private String name;

  @OneToMany
  @JoinColumn(name = "book_store_id")
  private Set<Book> books = new HashSet<>();


  @Builder
  public BookStore(final Long id, final String name) {
    this.id = id;
    this.name = name;
  }

  public void addBook(final Book book) {
    this.books.add(book);
  }

}
```

```java
@DataJpaTest
public class JpaTest3 {

  @Autowired
  private BookRepository bookRepository;

  @Autowired
  private BookStoreRepository bookStoreRepository;

  @Autowired
  private EntityManager em;

  @DisplayName("@OneToMany ë‹¨ë°©í–¥ í…ŒìŠ¤íŠ¸")
  @Test
  void oneToManyTest() throws Exception {
    //given

    Book book = Book.builder()
      .title("í…ŒìŠ¤íŠ¸ë¶")
      .author("í…ŒìŠ¤íŠ¸ì €ì")
      .build();

    BookStore bookStore = BookStore.builder()
      .name("í…ŒìŠ¤íŠ¸ë¶ìŠ¤í† ì–´")
      .build();

    bookStore.addBook(book);

    bookRepository.save(book);
    bookStoreRepository.save(bookStore);

    System.out.println("======= ì“°ê¸° ì§€ì—° ========");
    em.flush();

    //when

    //then
  }

}

```

```text
Hibernate: 
    insert 
    into
        book
        (author, title, id) 
    values
        (?, ?, default)
Hibernate: 
    insert 
    into
        book_store
        (name, id) 
    values
        (?, default)
======= ì“°ê¸° ì§€ì—° ========
Hibernate: 
    update
        book 
    set
        book_store_id=? 
    where
        id=?


```
- id ìƒì„± ì „ëµì´ IDENTITY ì´ë¯€ë¡œ ì“°ê¸° ì§€ì—°ì€ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë”°ë¼ì„œ saveì‹œì ì— ë°”ë¡œ INSERTì¿¼ë¦¬ê°€ ì‹¤í–‰ë©ë‹ˆë‹¤.
- BookStoreì— Bookì„ ì¶”ê°€í•˜ì˜€ê³  BookStoreê°€ ì—°ê´€ê´€ê³„ ì£¼ì¸ì´ê¸° ë•Œë¬¸ì— ë‘˜ì˜ ê´€ê³„ê°€ DBì— ë°˜ì˜ë©ë‹ˆë‹¤.
- Bookí…Œì´ë¸”ì— ì™¸ë˜í‚¤ì¸ BookStore idë¥¼ ì—…ë°ì´íŠ¸í•˜ê¸° ìœ„í•´ ì—…ë°ì´íŠ¸ ì¿¼ë¦¬ê°€ ì‹¤í–‰ë©ë‹ˆë‹¤.

##### ì–‘ë°©í–¥

@OneToMany ì–‘ë°©í–¥ì‹œì— @ManyToOne ìª½ì€ ì½ê¸°, ì“°ê¸°ë¥¼ false ì²˜ë¦¬í•´ì•¼í•©ë‹ˆë‹¤.

```java
@Entity
@Table
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@Data
public class Book {

	@Id
	@GeneratedValue(strategy = GenerationType.IDENTITY)
	private Long id;

	private String title;

	private String author;

	@ManyToOne
	@JoinColumn(name = "book_store_id", insertable = false, updatable = false) // ì›íˆ¬ë§¤ë‹ˆ ì–‘ë°©í–¥ì‹œì— ë§¤ë‹ˆíˆ¬ì›ìª½ì€ ì½ê¸°, ì“°ê¸°ë¥¼ falseë¡œí•´ì•¼í•¨
	private BookStore bookStore;

	@Builder
	public Book(final Long id, final String title, final String author) {
		this.id = id;
		this.title = title;
		this.author = author;
	}

}


@Entity
@Table
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@Data
public class BookStore {

  @Id
  @GeneratedValue(strategy = GenerationType.IDENTITY)
  private Long id;

  private String name;

  @OneToMany
  @JoinColumn(name = "book_store_id")
  private Set<Book> books = new HashSet<>();


  @Builder
  public BookStore(final Long id, final String name) {
    this.id = id;
    this.name = name;
  }

  public void addBook(final Book book) {
    this.books.add(book);
  }

}
```

- ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì€ ì—¬ì „íˆ Manyìª½ì— ì¡´ì¬í•©ë‹ˆë‹¤. ë‹¨ì§€ ì™¸ë˜í‚¤ë¥¼ Oneìª½ì—ì„œ ê´€ë¦¬í• ë¿ì…ë‹ˆë‹¤.
- í…ŒìŠ¤íŠ¸ ê²°ê³¼ëŠ” ìœ„ì— ë‹¨ë°©í–¥ê³¼ ë™ì¼í•©ë‹ˆë‹¤.

#### @OneToOne

ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì€ DBìƒ ì™¸ë˜í‚¤ê°€ ìˆëŠ” ìª½ì´ ë©ë‹ˆë‹¤. ì•„ë˜ ì˜ˆì œëŠ” ê³ ê°ì´ ì¹´ë“œì˜ ì™¸ë˜í‚¤ë¥¼ ê°–ê³  ìˆì„ë•Œì…ë‹ˆë‹¤.
ë”°ë¼ì„œ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì€ ê³ ê°ì´ ë©ë‹ˆë‹¤. ë‹¨ë°©í–¥, ì–‘ë°©í–¥ ëª¨ë‘ @ManyToOneê³¼ ìœ ì‚¬í•©ë‹ˆë‹¤. 
í•˜ì§€ë§Œ JPAëŠ” @OneToOneì˜ ê²½ìš° ì—°ê´€ê´€ê³„ ì£¼ì¸ì´ ì•„ë‹Œ ìª½ì´ ì™¸ë˜í‚¤ë¥¼ ê´€ë¦¬í•˜ëŠ” ê²½ìš°ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.


##### ë‹¨ë°©í–¥

![img.png](/assets/posts/img_5.png)

```java
@Entity
@Table
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@Data
public class Customer {

  @Id
  @GeneratedValue(strategy = GenerationType.IDENTITY)
  private Long id;

  private String name;

  @OneToOne(mappedBy = "customer_id")
  private Card card;

  @Builder
  public Customer(final Long id, final String name, final Card card) {
    this.id = id;
    this.name = name;
    this.card = card;
  }


}

@Entity
@Table
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@Data
public class Card {

  @Id
  @GeneratedValue(strategy = GenerationType.IDENTITY)
  private Long id;

  private String number;

  @OneToOne
  @JoinColumn(name = "customer_id")
  private Customer customer;

  @Builder
  public Card(final Long id, final String number) {
    this.id = id;
    this.number = number;
  }
}
```

```java
@SpringBootTest
public class JpaTest4 {


	@Autowired
	private CardRepository cardRepository;

	@Autowired
	private CustomerRepository customerRepository;

	@Autowired
	private EntityManager em;


	@DisplayName("@OneToOne ë‹¨ë°©í–¥ ê´€ê³„ í…ŒìŠ¤íŠ¸")
	@Test
	void oneToManyTest() throws Exception {
	    //given
		Customer customer = Customer.builder()
			.name("í…ŒìŠ¤íŠ¸ê³ ê°")
			.build();

		Card card = Card.builder()
			.number("1234")
			.customer(customer)
			.build();
		//when

		customerRepository.save(customer);
		cardRepository.save(card);


	    //then
	}
}
```
```text
Hibernate: 
    insert 
    into
        customer
        (name, id) 
    values
        (?, default)
Hibernate: 
    insert 
    into
        card
        (card_id, number, id) 
    values
        (?, ?, default)
```
![img_8.png](/assets/posts/img_8.png)
![img_9.png](/assets/posts/img_9.png)

- @OneToManyëŠ” ì™¸ë˜í‚¤ë¥¼ ì£¼ì¸ì´ ì•„ë‹Œ ìª½ì—ì„œ ê´€ë¦¬í•˜ëŠ” ê²½ìš°, ì¦‰ BookStoreì—ì„œ Bookì„ ì¶”ê°€í•˜ê³  ë‘˜ ë‹¤ saveë¥¼ í• ë•Œ
  ë‘˜ ê´€ê³„ë¥¼ DBì— ë°˜ì˜í•˜ê¸° í•˜ê³  Book ìª½ ì™¸ë˜í‚¤ê°€ ì—…ë°ì´íŠ¸ ë˜ì—ˆìŠµë‹ˆë‹¤.
- í•˜ì§€ë§Œ @OneToOneì€ ì£¼ì¸ì´ ì•„ë‹Œìª½ì—ì„œ ê´€ë¦¬í•˜ê²Œ ë˜ë©´, ì£¼ì¸ì´ ì•„ë‹Œìª½ì—ë„ ì™¸ë˜í‚¤ê°€ ìƒê¸°ê³  ì£¼ì¸ìª½ ì™¸ë˜í‚¤ëŠ” ì—…ë°ì´íŠ¸ë˜ì§€ ì•Šì•„ nullì´ ë“¤ì–´ê°€ê²Œ ë©ë‹ˆë‹¤.
- JpaëŠ” @OneToOneì—ì„œ ì£¼ì¸ì´ ì•„ë‹Œìª½ì´ ì™¸ë˜í‚¤ë¥¼ ê´€ë¦¬í•˜ëŠ”ê²ƒì„ ì§€ì›í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ”ê±¸ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ë”°ë¼ì„œ @OneToOneì˜ ì™¸ë˜í‚¤ëŠ” ë¬´ì¡°ê±´ í•´ë‹¹ ì™¸ë˜í‚¤ë¥¼ ê°€ì§€ê³  ìˆëŠ” ê°ì²´ì—ì„œ ê´€ë¦¬ë¥¼ í•´ì•¼í•©ë‹ˆë‹¤.


##### ì–‘ë°©í–¥
```java
@Entity
@Table
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@Data
public class Customer {

  @Id
  @GeneratedValue(strategy = GenerationType.IDENTITY)
  private Long id;

  private String name;

  @OneToOne(fetch = FetchType.LAZY)
  @JoinColumn(name = "card_id")
  private Card card;

  @Builder
  public Customer(final Long id, final String name, final Card card) {
    this.card = card;
    this.id = id;
    this.name = name;
  }
}


@Entity
@Table
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@Data
public class Card {

  @Id
  @GeneratedValue(strategy = GenerationType.IDENTITY)
  private Long id;

  private String number;

  @OneToOne(mappedBy = "card", fetch = FetchType.LAZY)
  private Customer customer;

  @Builder
  public Card(final Long id, final String number, final Customer customer) {
    this.id = id;
    this.number = number;
    this.customer = customer;
  }


  // ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì„œë“œ
  public void updateCustomer(final Customer customer) {
    customer.setCard(this);
    this.customer = customer;
  }
}
```
- ê³ ê° í…Œì´ë¸”ì— ì¹´ë“œ ì™¸ë˜í‚¤ê°€ ì¡´ì¬í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì„œë¡œë¥¼ ì°¸ì¡°í•˜ëŠ” ì–‘ë°©í–¥ ì…ë‹ˆë‹¤.
- FetchëŠ” Lazyë¡œ ì‚¬ìš©í–ˆì§€ë§Œ ì™¸ë˜í‚¤ê°€ ì—†ëŠ” Cardì—ì„œ Cardë¥¼ ê°€ì ¸ì˜¬ë•ŒëŠ” EAGER ì „ëµê³¼ ë§ˆì°¬ê°€ì§€ë¡œ Customerì˜ ì •ë³´ë„ ê°™ì´ ê°€ì ¸ì˜¤ê²Œ ë©ë‹ˆë‹¤.
- ê·¸ ì´ìœ ëŠ” í•´ë‹¹ ì¹´ë“œ í”„ë¡ì‹œ ê°ì²´ì— ê³ ê°ì´ ì—†ìœ¼ë©´ nullì„ ë„£ì–´ì•¼í•˜ê¸° ë•Œë¬¸ì— ì–´ì©”ìˆ˜ì—†ì´ ê³ ê° í…Œì´ë¸”ì„ ì¡°íšŒí•´ì•¼ í•©ë‹ˆë‹¤.
  

```java

@DataJpaTest
public class JpaTest5 {

  @Autowired
  private CardRepository cardRepository;

  @Autowired
  private CustomerRepository customerRepository;

  @Autowired
  private EntityManager em;

  @DisplayName("@OneToOne ì–‘ë°©í–¥ í…ŒìŠ¤íŠ¸")
  @Test
  void oneToOneTest() throws Exception {
    //given

    Card card = Card.builder()
      .number("1234")
      .build();

    Customer customer = Customer.builder()
      .card(card)
      .name("í…ŒìŠ¤íŠ¸ê³ ê°")
      .build();

    Card card1 = Card.builder()
      .number("4321")
      .build();

    Customer customer1 = Customer.builder()
      .card(card1)
      .name("í…ŒìŠ¤íŠ¸ê³ ê°1")
      .build();

    //when
    card.updateCustomer(customer);

    cardRepository.save(card);
    customerRepository.save(customer);
    cardRepository.save(card1);
    customerRepository.save(customer1);

    /**
     * DBì— ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ìŒ“ì¸ ì¿¼ë¦¬ë°˜ì˜, 1ì°¨ ìºì‹œ ì§€ìš°ê¸°
     */
    em.flush();
    em.clear();

    System.out.println("=== ëª¨ë“  ì¹´ë“œ ì¡°íšŒì‹œ ê³ ê°ë„ í•¨ê»˜ ê°€ì ¸ì˜¨ë‹¤ ===");
    List<Card> cards = cardRepository.findAll();
    System.out.println("====================================");

    System.out.println("=========== ì¶”ê°€ì ì¸ SELECT ì¿¼ë¦¬ê°€ ì‹¤í–‰ì•ˆëœë‹¤ ============");
    for (Card c : cards) {
      System.out.println(c.getCustomer().getName());
    }
    System.out.println("====================================================");

    /**
     * ìœ„ì—ì„œ ì¹´ë“œë¥¼ ê°€ì ¸ì˜¨ê²ƒì´ 1ì°¨ ìºì‹œì— ì €ì¥ì´ ë˜ì–´ìˆë‹¤.
     * ë”°ë¼ì„œ 1ì°¨ ìºì‹œë¥¼ ë¹„ìš°ì§€ ì•Šìœ¼ë©´ ê³ ê°ì—ì„œ ì¹´ë“œë¥¼ ì¡°íšŒí• ë•Œ 1ì°¨ ìºì‹œì—ì„œ ê°€ì ¸ì˜¤ê¸°ë•Œë¬¸ì— SELECTì¿¼ë¦¬ê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤.
     */
    em.clear();

    System.out.println("=== ëª¨ë“  ê³ ê° ì¡°íšŒì‹œ ê³ ê°ë§Œ ê°€ì ¸ì˜¨ë‹¤ ===");
    List<Customer> customers = customerRepository.findAll();
    System.out.println("================================");

    System.out.println("=========== ì¶”ê°€ì ì¸ SELECT ì¿¼ë¦¬ê°€ ì‹¤í–‰ëœë‹¤. =============");
    for (Customer cus : customers) {
      System.out.println(cus.getCard().getNumber());
    }
    System.out.println("====================================================");

    //then
  }
}


```
```text
[Hibernate] 
    insert 
    into
        card
        (number, id) 
    values
        (?, default)
[Hibernate] 
    insert 
    into
        customer
        (card_id, name, id) 
    values
        (?, ?, default)
[Hibernate] 
    insert 
    into
        card
        (number, id) 
    values
        (?, default)
[Hibernate] 
    insert 
    into
        customer
        (card_id, name, id) 
    values
        (?, ?, default)
=== ëª¨ë“  ì¹´ë“œ ì¡°íšŒì‹œ ê³ ê°ë„ í•¨ê»˜ ê°€ì ¸ì˜¨ë‹¤ ===
[Hibernate] 
    select
        c1_0.id,
        c1_0.number 
    from
        card c1_0
[Hibernate] 
    select
        c1_0.id,
        c1_0.card_id,
        c1_0.name 
    from
        customer c1_0 
    where
        c1_0.card_id=?
[Hibernate] 
    select
        c1_0.id,
        c1_0.card_id,
        c1_0.name 
    from
        customer c1_0 
    where
        c1_0.card_id=?
====================================
=========== ì¶”ê°€ì ì¸ SELECT ì¿¼ë¦¬ê°€ ì‹¤í–‰ì•ˆëœë‹¤ ============
í…ŒìŠ¤íŠ¸ê³ ê°
í…ŒìŠ¤íŠ¸ê³ ê°1
====================================================
=== ëª¨ë“  ê³ ê° ì¡°íšŒì‹œ ê³ ê°ë§Œ ê°€ì ¸ì˜¨ë‹¤ ===
[Hibernate] 
    select
        c1_0.id,
        c1_0.card_id,
        c1_0.name 
    from
        customer c1_0
================================
=========== ì¶”ê°€ì ì¸ SELECT ì¿¼ë¦¬ê°€ ì‹¤í–‰ëœë‹¤. =============
[Hibernate] 
    select
        c1_0.id,
        c1_0.number 
    from
        card c1_0 
    where
        c1_0.id=?
[Hibernate] 
    select
        c1_0.id,
        c1_0.card_id,
        c1_0.name 
    from
        customer c1_0 
    where
        c1_0.card_id=?
1234
[Hibernate] 
    select
        c1_0.id,
        c1_0.number 
    from
        card c1_0 
    where
        c1_0.id=?
[Hibernate] 
    select
        c1_0.id,
        c1_0.card_id,
        c1_0.name 
    from
        customer c1_0 
    where
        c1_0.card_id=?
4321
====================================================
```

- INSERTë¬¸ì€ ë¬´ì‹œí•˜ì‹œê³  ì•„ë˜ SELECTë¬¸ì„ ë³´ì‹œë©´ ëª¨ë“  Cardë¥¼ ì¡°íšŒí• ë•Œ ì¶”ê°€ë¡œ Customerì— SELECT ì¿¼ë¦¬ê°€ ë°œìƒí•˜ëŠ”ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ì•ì „ì— ë§ì”€ë“œë¦°ê²ƒ ì²˜ëŸ¼ Card í”„ë¡ì‹œ ê°ì²´ì— ìˆëŠ” Customerì˜ null ìœ ë¬´ë¥¼ íŒë‹¨í•˜ê¸° ìœ„í•´ì„œ SELECT ì¿¼ë¦¬ê°€ ì‹¤í–‰ëœê²ƒì…ë‹ˆë‹¤.
- Customerì˜ null ìœ ë¬´ë§Œ íŒë‹¨í•˜ë©´ ë˜ë¯€ë¡œ EAGER ì²˜ëŸ¼ left joinìœ¼ë¡œ ê°€ì ¸ì˜¤ì§€ ì•ŠìŠµë‹ˆë‹¤.
- CardëŠ” findAll()ì— ì˜í•´ 1ì°¨ ìºì‹œì— ì €ì¥ë˜ì–´ ìˆëŠ” ìƒíƒœì…ë‹ˆë‹¤.
- ë”°ë¼ì„œ em.clear()ë¡œ 1ì°¨ ìºì‹œë¥¼ ë¹„ìš°ì§€ ì•Šìœ¼ë©´ Customer ê°ì²´ì—ì„œ Card ì •ë³´ë¥¼ ì¡°íšŒí• ë•Œ 1ì°¨ ìºì‹œì— ìˆëŠ” Cardë¥¼ ì‚¬ìš©í•˜ê²Œ ë©ë‹ˆë‹¤. 
- CustomerëŠ” ì™¸ë˜í‚¤ë¥¼ ê°€ì§„ ì£¼ì²´ì´ê¸° ë•Œë¬¸ì— LAZYì „ëµì´ ì˜ë°˜ì˜ë˜ì—ˆê³ , Customerì—ì„œ card ì •ë³´ë¥¼ êº¼ë‚´ì˜¤ëŠ” ì‹œì ì— Customer ê°ì²´ ìˆ˜ ë§Œí¼ ì¶”ê°€ ì¿¼ë¦¬ê°€ ë°œìƒí•˜ì˜€ìŠµë‹ˆë‹¤(N + 1)


```text
[Hibernate] 
    insert 
    into
        card
        (number, id) 
    values
        (?, default)
[Hibernate] 
    insert 
    into
        customer
        (card_id, name, id) 
    values
        (?, ?, default)
[Hibernate] 
    insert 
    into
        card
        (number, id) 
    values
        (?, default)
[Hibernate] 
    insert 
    into
        customer
        (card_id, name, id) 
    values
        (?, ?, default)
=== ëª¨ë“  ì¹´ë“œ ì¡°íšŒì‹œ ê³ ê°ë„ í•¨ê»˜ ê°€ì ¸ì˜¨ë‹¤ ===
[Hibernate] 
    select
        c1_0.id,
        c1_0.number 
    from
        card c1_0
[Hibernate] 
    select
        c1_0.id,
        c2_0.id,
        c2_0.number,
        c1_0.name 
    from
        customer c1_0 
    left join
        card c2_0 
            on c2_0.id=c1_0.card_id 
    where
        c1_0.card_id=?
[Hibernate] 
    select
        c1_0.id,
        c2_0.id,
        c2_0.number,
        c1_0.name 
    from
        customer c1_0 
    left join
        card c2_0 
            on c2_0.id=c1_0.card_id 
    where
        c1_0.card_id=?
====================================
=========== ì¶”ê°€ì ì¸ SELECT ì¿¼ë¦¬ê°€ ì‹¤í–‰ì•ˆëœë‹¤ ============
í…ŒìŠ¤íŠ¸ê³ ê°
í…ŒìŠ¤íŠ¸ê³ ê°1
====================================================
=== ëª¨ë“  ê³ ê° ì¡°íšŒì‹œ ê³ ê°ë§Œ ê°€ì ¸ì˜¨ë‹¤ ===
[Hibernate] 
    select
        c1_0.id,
        c1_0.card_id,
        c1_0.name 
    from
        customer c1_0
[Hibernate] 
    select
        c1_0.id,
        c2_0.id,
        c2_0.name,
        c1_0.number 
    from
        card c1_0 
    left join
        customer c2_0 
            on c1_0.id=c2_0.card_id 
    where
        c1_0.id=?
[Hibernate] 
    select
        c1_0.id,
        c2_0.id,
        c2_0.name,
        c1_0.number 
    from
        card c1_0 
    left join
        customer c2_0 
            on c1_0.id=c2_0.card_id 
    where
        c1_0.id=?
================================
=========== ì¶”ê°€ì ì¸ SELECT ì¿¼ë¦¬ê°€ ì‹¤í–‰ëœë‹¤. =============
1234
4321
====================================================

```
- ì „ëµì„ EAGERë¡œ ë°”ê¾¸ë©´ Card, Customer ëª¨ë‘ ì¡°íšŒì‹œ left joinìœ¼ë¡œ ì—°ê´€ëœ ê°ì²´ë¥¼ ì „ë¶€ ê°€ì ¸ì˜¤ê²Œ ë©ë‹ˆë‹¤.
- ë”°ë¼ì„œ Customerì—ì„œë„ N+1 ë¬¸ì œê°€ ì‚¬ë¼ì§€ê²Œ ë©ë‹ˆë‹¤.
- í•˜ì§€ë§Œ EAGERëŠ” ë§ì”€ë“œë¦°ëŒ€ë¡œ ì—°ê´€ëœ ëª¨ë“  ê°ì²´ë¥¼ ë‹¤ê°€ì ¸ì˜¤ê¸° ë•Œë¬¸ì— ì „ë¶€ ì‚¬ìš©í•˜ëŠ”ê²ƒì´ ì•„ë‹ˆë¼ë©´ ë©”ëª¨ë¦¬ ì¸¡ë©´ì—ì„œ ë¹„íš¨ìœ¨ì ì…ë‹ˆë‹¤.
- ë”°ë¼ì„œ ì—°ê´€ëœ ì¼ë¶€ ê°ì²´ë§Œ í•„ìš”í•˜ë‹¤ë©´ LAZY ì „ëµì„ ê¸°ë°˜ìœ¼ë¡œ fetch join, entityGraph ë“± ë°©ë²•ì„ ì‚¬ìš©í•´ì•¼í•©ë‹ˆë‹¤.
  í•´ë‹¹ ë‚´ìš©ì€ ì¶”í›„ ë‹¤ë¥¸ í¬ìŠ¤íŒ…ì—ì„œ ë‹¤ë£¨ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.


### ì°¸ê³ 
> @ManyToManyëŠ” [ì—°ê´€ ê´€ê³„ ë§¤í•‘ (3)](/posts/ì—°ê´€ê´€ê³„3)ì—ì„œ ë‹¤ë£¨ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.


## âœ¨ Summary

#### @ManyToOne
- ê°€ì¥ ë§ì´ ì‚¬ìš©
- Manyìª½ì— ì™¸ë˜í‚¤ê°€ ìƒì„±ë˜ê³ , ì—°ê´€ ê´€ê³„ì˜ ì£¼ì¸ì€ Many

#### @OneToMany
- @ManyToOneê³¼ ì–‘ë°©í–¥ ë§¤í•‘ì‹œ ì£¼ë¡œ ì‚¬ìš©ë¨
- Manyìª½ì— ì™¸ë˜í‚¤ê°€ ìƒì„±ë˜ê³ , ì—°ê´€ ê´€ê³„ì˜ ì£¼ì¸ì€ Many
- ì™¸ë˜í‚¤ê°€ ì—†ëŠ” Oneìª½ì—ì„œ ì™¸ë˜í‚¤ë¥¼ ê´€ë¦¬í•˜ê²Œë” í•  ìˆ˜ ìˆìŒ(ê¶Œì¥ X)

#### @OneToOne
- ë‘ ì—”í‹°í‹°ê°€ 1:1ë¡œ ë§¤í•‘
- @OneToManyì™€ ë‹¤ë¥´ê²Œ ì™¸ë˜í‚¤ê°€ ì—†ëŠ” ìª½ì—ì„œ ì™¸ë˜í‚¤ë¥¼ ê´€ë¦¬í•  ìˆ˜ ì—†ìŒ
- ë¬´ì¡°ê±´ ì™¸ë˜í‚¤ë¥¼ ê°€ì§„ìª½ì´ ì™¸ë˜í‚¤ë¥¼ ê´€ë¦¬í•´ì•¼í•¨
- ì´ë¯¸ DBì— ì™¸ë˜í‚¤ê°€ ì¡í˜€ìˆê³ , ì™¸ë˜í‚¤ê°€ ì—†ëŠ” ìª½ì—ì„œ ëŒ€ìƒ í…Œì´ë¸”ì— ì¡°íšŒê°€ ë§ì„ ì‹œ ì–‘ë°©í–¥ ë§¤í•‘ì„ ê³ ë ¤
- ì–‘ë°©í–¥ ë§¤í•‘ì´ ë˜ì–´ìˆì„ë•Œ ì™¸ë˜í‚¤ê°€ Aì— ìˆë‹¤ë©´ ì™¸ë˜í‚¤ê°€ ì—†ëŠ” Bê°€ findAllë¡œ Bê°ì²´ë¥¼ ì¡°íšŒì‹œ,
  í”„ë¡ì‹œ ê°ì²´ì— Aì˜ null ìœ ë¬´ë¥¼ ì•Œì•„ì•¼í•˜ë¯€ë¡œ EAGERì²˜ëŸ¼ Aì˜ ì •ë³´ë„ ëª¨ë‘ ê°€ì ¸ì˜´

#### LAZY vs EAGER
- ìƒí™©ì— ë”°ë¼ ì ì ˆíˆ ì‚¬ìš©í•´ì•¼í•¨
- ì£¼ë¡œ LAZY ê¸°ë°˜ìœ¼ë¡œ fetch join, EntityGraphë“±ì„ ì‚¬ìš©í•˜ì—¬ ì—°ê´€ëœ ê°ì²´ì¤‘ í•„ìš”í•œ ë†ˆë“¤ë§Œ ê³¨ë¼ì„œ í•¨ê»˜ ê°€ì ¸ì˜´
- ì¶”í›„ ë‹¤ë¥¸ í¬ìŠ¤íŒ…ì—ì„œ ìì„¸íˆ ë‹¤ë£° ì˜ˆì •
 

