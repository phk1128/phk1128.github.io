---
title: 3-way handshake & 4-way handshake
date: 2024-09-11
categories: [ CS, Network ]
tags: [ λ„¤νΈμ›ν¬, network, CS, 3-way handshake, 4-way handshake ]
image: assets/posts/img_12.png
---

## π¬ Intro
> 3-way handshake & 4-way handshakeμ— λ€ν•΄ μ•μ•„λ΄…μ‹λ‹¤.

### β… 3-way handshake
![img.png](/assets/posts/img_19.png)

3-Way Handshakeλ” ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„μ™€ μ—°κ²°μ„ μ„¤μ •ν•κΈ° μ„ν•΄ μ‚¬μ©ν•λ” κ³Όμ •μ…λ‹λ‹¤. μ΄ κ³Όμ •μ€ μ—°κ²°μ„ μ•μ •μ μΌλ΅ μ„¤μ •ν•κ³ , λ°μ΄ν„° μ „μ†΅μ„ μ‹μ‘ν•κΈ° μ „μ— ν†µμ‹  κ²½λ΅λ¥Ό ν™•μΈν•λ” λ‹¨κ³„μ…λ‹λ‹¤.

- SYN (Synchronization): μ—°κ²° μ”μ²­μ„ λ‚νƒ€λ‚΄λ©°, ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„μ— μ„Έμ…μ„ μ„¤μ •ν•κΈ° μ„ν•΄ μ΄κΈ° μ‹ν€€μ¤ λ²νΈλ¥Ό μ „μ†΅ν•©λ‹λ‹¤.
- ACK (Acknowledgement): μ„λ²„κ°€ ν΄λΌμ΄μ–ΈνΈμ μ‹ν€€μ¤ λ²νΈμ— 1μ„ λ”ν• ACKλ¥Ό λ°ν™ν•μ—¬ μ”μ²­μ„ ν™•μΈν•©λ‹λ‹¤.


#### Step 1: ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„λ΅ SYN μ „μ†΅

- ν΄λΌμ΄μ–ΈνΈλ” μ„λ²„μ™€μ μ—°κ²°μ„ μ„¤μ •ν•κΈ° μ„ν•΄ SYN ν¨ν‚·μ„ μ „μ†΅ν•©λ‹λ‹¤. μ΄ ν¨ν‚·μ—λ” ν΄λΌμ΄μ–ΈνΈ μΈ΅μ μ΄κΈ° μ‹ν€€μ¤ λ²νΈκ°€ ν¬ν•¨λ©λ‹λ‹¤.
- **μ΄κΈ° μ‹ν€€μ¤ λ²νΈ(ISN)** λ‚μλ΅ μ§€μ •λ©λ‹λ‹¤.
  - μ»¤λ„¥μ…μ„ λ§Ίμ„ λ• μ‚¬μ©ν•λ” ν¬νΈλ” μ ν•ν• λ²”μ„ λ‚΄μ—μ„ μ‚¬μ©λλ©°, μ‹κ°„μ΄ μ§€λ‚λ©΄ μ¬μ‚¬μ©λ  μ μμµλ‹λ‹¤.
    λ”°λΌμ„ λ‘ ν†µμ‹  νΈμ¤νΈκ°€ κ³Όκ±°μ— μ‚¬μ©λ ν¬νΈ λ²νΈ μμ„ λ‹¤μ‹ μ‚¬μ©ν•  κ°€λ¥μ„±μ΄ μ΅΄μ¬ν•©λ‹λ‹¤. μ„λ²„ μΈ΅μ—μ„λ” μ„Έκ·Έλ¨ΌνΈμ SYNμ„ λ³΄κ³  μ„Έκ·Έλ¨ΌνΈλ¥Ό κµ¬λ¶„ν•λ”λ°, λ§μ•½ μ‹ν€€μ¤ λ²νΈκ°€ λ‚μκ°€ μ•„λ‹ μμ°¨μ μΈ λ²νΈλ΅ μ „μ†΅λλ‹¤λ©΄, μ΄μ „μ μ»¤λ„¥μ…μ—μ„ μ¨ μ„Έκ·Έλ¨ΌνΈλ΅ μλ» μΈμ‹λ  μ μμµλ‹λ‹¤.
    μ΄λ¬ν• λ¬Έμ λ¥Ό λ°©μ§€ν•κΈ° μ„ν•΄ **μ΄κΈ° μ‹ν€€μ¤ λ²νΈ(ISN)**λ” λ‚μλ΅ μ„¤μ •λ©λ‹λ‹¤.
  
  - μλ¥Ό λ“¤μ–΄, μ΄μ „ μ—°κ²°μ—μ„ μ‚¬μ©λ ISNμ΄ 100μ΄κ³ , ν„μ¬ μ—°κ²°μ—μ„ μ‚¬μ©λ ISNμ΄ 200μ΄λΌκ³  κ°€μ •ν•λ©΄,
    μ΄μ „ μ—°κ²°μ λ°μ΄ν„° μ„Έκ·Έλ¨ΌνΈλ” μ‹ν€€μ¤ λ²νΈ 100λ¶€ν„° μ‹μ‘ν•  κ²ƒμ…λ‹λ‹¤. λ°λ©΄μ—, μƒλ΅μ΄ μ—°κ²°μ—μ„λ” ISNμ΄ 200λ¶€ν„° μ‹μ‘ν•λ―€λ΅,
    μ„λ΅ λ‹¤λ¥Έ μ‹ν€€μ¤ λ²νΈλ΅ μΈν•΄ μ΄μ „ μ—°κ²°μ λ°μ΄ν„°κ°€ ν„μ¬ μ—°κ²°λ΅ μλ» μ „λ‹¬λλ” μƒν™©μ„ λ°©μ§€ν•  μ μμµλ‹λ‹¤.

#### Step 2: μ„λ²„κ°€ SYN + ACK μ „μ†΅

- μ„λ²„λ” ν΄λΌμ΄μ–ΈνΈλ΅λ¶€ν„° SYN ν¨ν‚·μ„ μμ‹ ν• ν›„, μ”μ²­μ„ μλ½ν–μμ„ λ‚νƒ€λ‚΄λ” **ACK ν¨ν‚·**κ³Ό μ„λ²„ μΈ΅μ μ‹ν€€μ¤ λ²νΈλ¥Ό λ‹΄μ€ **SYN ν¨ν‚·**μ„ λ™μ‹μ— λ³΄λƒ…λ‹λ‹¤.
- μ„λ²„λ„ ν΄λΌμ΄μ–ΈνΈμ™€ λ§μ°¬κ°€μ§€λ΅ λ‚μλ¥Ό μ‹ν€€μ¤ λ²νΈλ΅ μ„¤μ •ν•©λ‹λ‹¤.
- μ„λ²„κ°€ ν΄λΌμ΄μ–ΈνΈμ—κ² λ³΄λ‚΄λ” ACKλ” ν΄λΌμ΄μ–ΈνΈκ°€ λ³΄λ‚Έ μ‹ν€€μ¤ λ²νΈμ— **+1**μ„ ν• κ°’μ„ λ°ν™ν•©λ‹λ‹¤.

#### Step 3: ν΄λΌμ΄μ–ΈνΈκ°€ ACK μ „μ†΅

- ν΄λΌμ΄μ–ΈνΈλ” μ„λ²„λ΅λ¶€ν„° SYNκ³Ό ACK ν¨ν‚·μ„ λ°›μΌλ©΄, μ„λ²„μ μ‹ν€€μ¤ λ²νΈμ— **+1**μ„ ν• **ACK ν¨ν‚·**μ„ μ„λ²„λ΅ μ „μ†΅ν•©λ‹λ‹¤.
- μ΄ μ‹μ μ—μ„ **ν’€ λ“€ν”λ ‰μ¤(Full-Duplex)** ν†µμ‹ μ΄ κµ¬μ¶•λλ©°, μ–‘λ°©ν–¥ λ°μ΄ν„° μ „μ†΅μ΄ κ°€λ¥ν•©λ‹λ‹¤.
- Full - duplex ν†µμ‹ μ κµ¬μ„±
  - step 1,2 μ—μ„λ” ν΄λΌμ΄μ–ΈνΈ β†’ μ„λ²„ λ°©ν–¥μ— λ€ν• μ—°κ²° νλΌλ―Έν„°λ¥Ό μ„¤μ • ν•κ³  μ΄λ¥Ό μ„λ²„κ°€ μΉμΈ
  - step 2,3 μ—μ„λ” μ„λ²„ β†’ ν΄λΌμ΄μ–ΈνΈ λ°©ν–¥μ— λ€ν• μ—°κ²° νλΌλ―Έν„°λ¥Ό μ„¤μ • ν•κ³  μ΄λ¥Ό ν΄λΌμ΄μ–ΈνΈκ°€ μΉμΈ
  - μ΄λ¥Ό ν†µν•΄ full-duplex ν†µμ‹ μ΄ κµ¬μ¶•

---

![img.png](/assets/posts/img_20.png)

### β… 4-way handshake

**4-Way Handshake**λ” TCP μ—°κ²° μΆ…λ£ κ³Όμ •μ„ λ‚νƒ€λƒ…λ‹λ‹¤. μ—°κ²°μ„ μΆ…λ£ν•  λ•λ” **FIN ν”λκ·Έ**κ°€ μ‚¬μ©λλ©°, ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„κ°€ λ¨λ‘ λ°μ΄ν„°λ¥Ό μ „μ†΅ μ™„λ£ν–μμ„ ν™•μΈν•λ” κ³Όμ •μ„ κ±°μΉ©λ‹λ‹¤.

- **FIN** (Finish): λ” μ΄μƒ μ „μ†΅ν•  λ°μ΄ν„°κ°€ μ—†μμ„ λ‚νƒ€λ‚΄λ©°, μ—°κ²°μ„ μΆ…λ£ν•κΈ° μ„ν• μ”μ²­μ…λ‹λ‹¤.

#### Step 1: ν΄λΌμ΄μ–ΈνΈ β†’ μ„λ²„λ΅ FIN μ „μ†΅

- ν΄λΌμ΄μ–ΈνΈκ°€ μ—°κ²°μ„ μΆ…λ£ν•λ ¤κ³  ν•  λ• **FIN ν¨ν‚·**μ„ μ „μ†΅ν•©λ‹λ‹¤. μ΄ ν¨ν‚·μ€ ν΄λΌμ΄μ–ΈνΈκ°€ λ” μ΄μƒ λ³΄λ‚Ό λ°μ΄ν„°κ°€ μ—†μμ„ λ‚νƒ€λƒ…λ‹λ‹¤.

#### Step 2: μ„λ²„κ°€ ACK μ „μ†΅

- μ„λ²„λ” FIN ν¨ν‚·μ„ μμ‹ ν•κ³ , μ΄μ— λ€ν• **ACK ν¨ν‚·**μ„ ν΄λΌμ΄μ–ΈνΈμ—κ² μ „μ†΅ν•©λ‹λ‹¤. ACKλ” ν΄λΌμ΄μ–ΈνΈκ°€ λ³΄λ‚Έ μ‹ν€€μ¤ λ²νΈμ— **+1**μ„ λ”ν•΄ λ°ν™ν•©λ‹λ‹¤.
- μ„λ²„λ” μ•„μ§ μ „μ†΅ν•  λ°μ΄ν„°κ°€ λ‚¨μ•„ μμ„ μ μμΌλ―€λ΅, ν΄λΌμ΄μ–ΈνΈκ°€ FINμ„ λ³΄λ‚Έ ν›„μ—λ„ μ—°κ²°μ„ μ μ§€ν•©λ‹λ‹¤.

#### Step 3: μ„λ²„κ°€ FIN μ „μ†΅

- μ„λ²„λ” λ¨λ“  λ°μ΄ν„°λ¥Ό μ „μ†΅ν• ν›„, **FIN ν¨ν‚·**μ„ ν΄λΌμ΄μ–ΈνΈλ΅ μ „μ†΅ν•©λ‹λ‹¤. μ΄λ” μ„λ²„ μΈ΅μ—μ„ λ” μ΄μƒ λ³΄λ‚Ό λ°μ΄ν„°κ°€ μ—†μμ„ λ‚νƒ€λƒ…λ‹λ‹¤.

#### Step 4: ν΄λΌμ΄μ–ΈνΈκ°€ ACK μ „μ†΅

- ν΄λΌμ΄μ–ΈνΈλ” μ„λ²„μ FIN ν¨ν‚·μ„ μμ‹ ν• ν›„ **ACK ν¨ν‚·**μ„ μ „μ†΅ν•©λ‹λ‹¤. μ΄λ΅μ¨ μ–‘μ½ λ¨λ‘ μ—°κ²° μΆ…λ£λ¥Ό ν™•μΈν•λ©°, **TIME_WAIT** μƒνƒμ— μ§„μ…ν•μ—¬ μ μ‹ λ€κΈ°ν• ν›„ μ—°κ²°μ΄ μ™„μ „ν μΆ…λ£λ©λ‹λ‹¤.

---

### β“TCP κ΄€λ ¨ μ§λ¬Έ

#### Q1: TCP μ—°κ²° μ„¤μ •(3λ‹¨κ³„)κ³Ό μ—°κ²° μΆ…λ£(4λ‹¨κ³„) κ³Όμ •μ΄ λ‹¨κ³„κ°€ λ‹¤λ¥Έ μ΄μ ?
**λ‹µλ³€**: ν΄λΌμ΄μ–ΈνΈκ°€ λ°μ΄ν„° μ „μ†΅μ„ μΆ…λ£ν–λ”λΌλ„ μ„λ²„λ” μ•„μ§ λ³΄λ‚Ό λ°μ΄ν„°κ°€ λ‚¨μ•„ μμ„ μ μμµλ‹λ‹¤. λ”°λΌμ„ ν΄λΌμ΄μ–ΈνΈκ°€ FIN ν¨ν‚·μ„ λ³΄λ‚΄λ©΄ μ„λ²„λ” ACK ν¨ν‚·μΌλ΅ μ‘λ‹µν• ν›„, λ°μ΄ν„°λ¥Ό λ¨λ‘ μ „μ†΅ν• λ‹¤μμ—μ•Ό FIN ν¨ν‚·μ„ λ³΄λ‚΄κ² λ©λ‹λ‹¤. μ΄ λ•λ¬Έμ— μ—°κ²° μΆ…λ£ κ³Όμ •μ€ 4λ‹¨κ³„λ΅ μ΄λ£¨μ–΄μ§‘λ‹λ‹¤.

#### Q2: μ„λ²„μ—μ„ FIN ν¨ν‚·λ³΄λ‹¤ λ¦κ² λ„μ°©ν•λ” ν¨ν‚·μ΄ μμ„ κ²½μ°?
**λ‹µλ³€**: μ΄λ¬ν• μƒν™©μ— λ€λΉ„ν•΄ ν΄λΌμ΄μ–ΈνΈλ” μ„λ²„λ΅λ¶€ν„° FIN ν¨ν‚·μ„ μμ‹ ν•λ”λΌλ„ **TIME_WAIT** μƒνƒμ— λ“¤μ–΄κ°‘λ‹λ‹¤. μ΄ κΈ°κ°„ λ™μ• μ‰μ—¬ ν¨ν‚·μ„ κΈ°λ‹¤λ¦¬λ©°, κΈ°λ³Έμ μΌλ΅ 240μ΄ λ™μ• μ„Έμ…μ„ μ μ§€ν•κ³  ν¨ν‚·μ„ μμ‹ ν•  μ¤€λΉ„λ¥Ό ν•©λ‹λ‹¤. μ΄λ¥Ό ν†µν•΄ μ§€μ—°λ ν¨ν‚·μ΄ μ—°κ²°μ΄ μΆ…λ£λ μ΄ν›„μ—λ„ μ•μ „ν•κ² μ²λ¦¬λ  μ μλ„λ΅ ν•©λ‹λ‹¤.

#### Q3: μ΄κΈ° μ‹ν€€μ¤ λ²νΈ(ISN)λ¥Ό λ‚μλ΅ μƒμ„±ν•λ” μ΄μ ?
**λ‹µλ³€**: ν¬νΈ λ²νΈλ” μ ν•ν• λ²”μ„λ¥Ό κ°€μ§€λ©°, μ‹κ°„μ΄ μ§€λ‚λ©΄ μ¬μ‚¬μ©λ  μ μμµλ‹λ‹¤. λ”°λΌμ„ μ΄μ „ μ—°κ²°μ—μ„ μ‚¬μ©λ ν¬νΈ λ²νΈμ™€ μ‹ν€€μ¤ λ²νΈκ°€ μƒλ΅μ΄ μ—°κ²°κ³Ό μ¤‘λ³µλ  κ°€λ¥μ„±μ΄ μμµλ‹λ‹¤. μ΄λ¥Ό λ°©μ§€ν•κΈ° μ„ν•΄ μ΄κΈ° μ‹ν€€μ¤ λ²νΈ(ISN)λ¥Ό λ‚μλ΅ μ„¤μ •ν•μ—¬ μ¤‘λ³µλ λ°μ΄ν„° ν¨ν‚·μ΄ μλ»λ μ—°κ²°λ΅ μΈμ‹λλ” κ²ƒμ„ λ°©μ§€ν•©λ‹λ‹¤.

---

## β¨ Summary
TCPμ **3-Way Handshake**λ” μ•μ •μ μΈ μ—°κ²°μ„ μ„¤μ •ν•κΈ° μ„ν• κ³Όμ •μ΄λ©°, **4-Way Handshake**λ” μ•μ „ν•κ² μ—°κ²°μ„ μΆ…λ£ν•κΈ° μ„ν• κ³Όμ •μ…λ‹λ‹¤. κ°κ°μ λ‹¨κ³„μ—μ„ μ‹ν€€μ¤ λ²νΈμ™€ ACK λ²νΈλ¥Ό ν™μ©ν•μ—¬ λ°μ΄ν„° μ „μ†΅μ μ‹ λΆ°μ„±μ„ λ³΄μ¥ν•λ©°, μ΄λ¥Ό ν†µν•΄ TCPλ” μ‹ λΆ°μ„± μλ” ν†µμ‹ μ„ μ κ³µν•©λ‹λ‹¤.
