---
title: EC2ì—ì„œ HTTPS ì„¤ì • í•˜ê¸° (with NGINX)
date: 2024-08-31
categories: [ Infra ]
tags: [ https, aws, ec2, DNS, nginx, SSL/TLS ]
image: assets/posts/img_3.png
---

## ğŸ¬ Intro

> EC2 ì¸ìŠ¤í„´ìŠ¤ ëŒ€ì—¬ ë°©ë²•ì€ ë”°ë¡œ ë‹¤ë£¨ì§€ ì•ŠìŠµë‹ˆë‹¤.
> ê·¸ëŸ¼ EC2ì— HTTPS í†µì‹ ì„ ìœ„í•´ SSL/TLS ì¸ì¦ì„œë¥¼ ë°œê¸‰ê³  ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë´…ì‹œë‹¤.

### ğŸªœ Step

- DNS êµ¬ë§¤ ë° ì„¤ì •
- nginx ì„¤ì¹˜ ë° ì„¤ì •
- SSL/TLS ì¸ì¦ì„œ ë°œê¸‰

### âœ… DNS êµ¬ë§¤ ë° ì„¤ì •

https í†µì‹ ì„ ìœ„í•´ SSL/TLS ì¸ì¦ì„œë¥¼ ë°›ê¸° ìœ„í•´ì„œëŠ” íŠ¹ì • ë„ë©”ì¸ì´ í•„ìš”í•˜ê¸° ë•Œë¬¸ì— ë„ë©”ì¸ì„ êµ¬ë§¤í•˜ì…”ì•¼í•©ë‹ˆë‹¤.
ì—¬ëŸ¬ DNS êµ¬ë§¤ ì‚¬ì´íŠ¸ê°€ ìˆì§€ë§Œ ì €ëŠ” ê°€ë¹„ì•„ì—ì„œ êµ¬ë§¤í–ˆìŠµë‹ˆë‹¤.

- https://www.gabia.com/ ì— ì ‘ì†í•´ì„œ íšŒì›ê°€ì…ì„ ì§„í–‰í•´ì¤ë‹ˆë‹¤.
- ì›í•˜ëŠ” ë„ë©”ì¸ì„ ê²€ìƒ‰í•˜ì‹œê³ , ë§ˆìŒì—ë“œëŠ” íƒ‘ ë ˆë²¨ì„ ì„ íƒ ë° ì‹ ì²­í•œë’¤ êµ¬ë§¤í•´ì¤ë‹ˆë‹¤. ì €ëŠ” .shopì´ 500ì›ìœ¼ë¡œ ê°€ì¥ ì €ë ´í•´ì„œ ì´ ë…€ì„ìœ¼ë¡œ êµ¬ë§¤í–ˆìŠµë‹ˆë‹¤.
- ìš°ì¸¡ ìƒë‹¨ì— `My gabia` -> `ì´ìš© ì¤‘ì¸ ì„œë¹„ìŠ¤ ë¸”ëŸ­`ì— `ë„ë©”ì¸` -> êµ¬ë§¤í•œ ë„ë§¤ì¸ `ê´€ë¦¬` -> `ë„ë©”ì¸ ê´€ë¦¬` ìˆœìœ¼ë¡œ ë“¤ì–´ì˜µë‹ˆë‹¤.
- ë„ë©”ì¸ ê´€ë¦¬ì˜ ë„ë©”ì¸ ë¦¬ìŠ¤íŠ¸ì—ì„œ êµ¬ë§¤í•œ ë„ë©”ì¸ì„ í´ë¦­í•´ì¤ë‹ˆë‹¤.
  ![img.png](/assets/posts/img.png)
- ë„ë©”ì¸ ì—°ê²° ì„¤ì •ì„ í´ë¦­í•©ë‹ˆë‹¤.
- êµ¬ë§¤í•œ ë„ë©”ì¸ì˜ ì„¤ì •ì„ í´ë¦­í•©ë‹ˆë‹¤.
- ë ˆì½”ë“œ ìˆ˜ì •ì„ í´ë¦­í•©ë‹ˆë‹¤.
  ![img_1.png](/assets/posts/img1.png)
- ìœ„ ì´ë¯¸ì§€ì— ê°’/ìœ„ì¹˜ë§Œ EC2ì˜ íƒ„ë ¥ì  IP ë˜ëŠ” í¼ë¸”ë¦­ IP ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ê³  ìˆ˜ì • ë° ì €ì¥ì„ í•©ë‹ˆë‹¤.

### âœ… nginx ì„¤ì¹˜ ë° ì„¤ì •

- nginxë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.

```shell
sudo apt-get install nginx
```

- nginx ì„¤ì •ì„ ë³€ê²½í•©ë‹ˆë‹¤.

```shell
sudo vim /etc/nginx/sites-available/default
```

![img_1.png](/assets/posts/img_2.png)

- sever_name ì— ê°€ë¹„ì•„ì—ì„œ êµ¬ë§¤í•œ ë„ë©”ì¸ ì´ë¦„ì„ ì…ë ¥í•´ì¤ë‹ˆë‹¤.
- location ë¸”ëŸ­ì€ url pathì— /api ê°€ ìˆì„ ê²½ìš° proxy_passì— ì íŒ ê²½ë¡œë¡œ ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ í•œë‹¤ëŠ” ê²ƒ ì…ë‹ˆë‹¤.
- ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œëŠ” í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì„ ë°›ì•„ì„œ ë‹¤ë¥¸ ì„œë²„ë¡œ ì „ë‹¬í•œë‹¤ëŠ” ì˜ë¯¸ ì…ë‹ˆë‹¤.
- ì„¤ì •ì´ ì˜ ì ìš©ë˜ëŠ”ì§€ í™•ì¸ í•˜ê³  ì¬ì‹œì‘í•©ë‹ˆë‹¤.

```shell
sudo nginx -t
sudo systemctl reload nginx
```

### âœ… SSL/TLS ì¸ì¦ì„œ ë°œê¸‰

ì´ì œ SSL ì¸ì¦ì„œë¥¼ ë°œê¸‰ë°›ê³  ì„¤ì •í•˜ëŠ” ë‹¨ê³„ë§Œ ë‚¨ì•˜ìŠµë‹ˆë‹¤. ì¸ì¦ì„œëŠ” Let's Encrypt(CA ì¸ì¦ê¸°ê´€)ì—ì„œ ë°œê¸‰ ë°›ëŠ”ë° ì´ë•Œ ì‚¬ìš©ë˜ëŠ” ë„êµ¬ê°€ certbot ì…ë‹ˆë‹¤.
ë”°ë¼ì„œ certbotì„ ì´ìš©í•´ì„œ ì¸ì¦ì„œ ë°œê¸‰ì„ ì§„í–‰í•˜ê² ìŠµë‹ˆë‹¤.

- certbotì„ ì„¤ì¹˜ ë° ì‹¤í–‰í•˜ê¸° ìœ„í•´ snapì„ ì„¤ì¹˜í•©ë‹ˆë‹¤.

```shell
sudo snap install core
sudo snap refresh core
```

- ê¸°ì¡´ì— ì„¤ì¹˜ ë˜ì–´ ìˆëŠ” certbotì„ ì œê±°í•©ë‹ˆë‹¤.

```shell
sudo apt-get remove certbot
```

- certbotì„ ì„¤ì¹˜í•˜ê³  í•„ìš” ë‹¨ê³„ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.

```shell
# ì„¤ì¹˜
sudo snap install --classic certbot

# ëª…ë ¹ì–´ ì‹¤í–‰ì„ ìœ„í•œ ì„¸íŒ…
sudo ln -s /snap/bin/certbot /usr/bin/certbot

# ê°€ë¹„ì•„ì—ì„œ êµ¬ë§¤í•œ ë„ë©”ì¸ì— SSL/TLS ì¸ì¦ì„œë¥¼ ë°œê¸‰
# ì´ ê³¼ì •ì—ì„œ email ì…ë ¥ ë‹¨ê³„ê°€ í•„ìš”
sudo certbot --nginx -d <ë„ë©”ì¸ ì´ë¦„> -d www.<ë„ë©”ì¸ ì´ë¦„>

# SSL/TLS ì¸ì¦ì„œë¥¼ ì ìš©
sudo certbot renew --dry-run
```

- ì„±ê³µì‹œ ë‹¤ìŒê³¼ ê°™ì€ ë©”ì„¸ì§€ê°€ ì¶œë ¥ ë©ë‹ˆë‹¤.

```shell
Saving debug log to /var/log/letsencrypt/letsencrypt.log
Requesting a certificate for forecast-test.shop and www.forecast-test.shop

Successfully received certificate.
Certificate is saved at: /etc/letsencrypt/live/forecast-test.shop/fullchain.pem
Key is saved at:         /etc/letsencrypt/live/forecast-test.shop/privkey.pem
This certificate expires on 2024-11-29.
These files will be updated when the certificate renews.
Certbot has set up a scheduled task to automatically renew this certificate in the background.

Deploying certificate
Successfully deployed certificate for forecast-test.shop to /etc/nginx/sites-enabled/default
Successfully deployed certificate for www.forecast-test.shop to /etc/nginx/sites-enabled/default
Congratulations! You have successfully enabled HTTPS on https://forecast-test.shop and https://www.forecast-test.shop

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
If you like Certbot, please consider supporting our work by:
 * Donating to ISRG / Let's Encrypt:   https://letsencrypt.org/donate
 * Donating to EFF:                    https://eff.org/donate-le
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
```

- ì´ì œ https://<êµ¬ë§¤í•œ ë„ë©”ì¸ ì´ë¦„> ìœ¼ë¡œ ì ‘ì†í•˜ë©´ EC2ì˜ localhost:8080ìœ¼ë¡œ ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œê°€ ë˜ê²Œ ë©ë‹ˆë‹¤

### ì°¸ê³ 

> - [EC2 ëŒ€ì—¬ í•˜ê¸°](https://velog.io/@sunblock99/AWS-%ED%94%84%EB%A6%AC%ED%8B%B0%EC%96%B4-EC2-%EC%9D%B8%EC%8A%A4%ED%84%B4%EC%8A%A4-%EB%A7%8C%EB%93%9C%EB%8A%94-%EB%B0%A9%EB%B2%95)
> - EC2ì˜ ë³´ì•ˆ ì¸ë°”ìš´ë“œ ê·œì¹™ì—ì„œ HTTPS 443ë¥¼ ì¶”ê°€í•˜ì…¨ëŠ”ì§€ ê¼­ í™•ì¸í•´ì£¼ì„¸ìš”.

## âœ¨Summary

#### ë„ë©”ì¸ êµ¬ë§¤

SSL/TLS ì¸ì¦ì„œë¥¼ ë°œê¸‰ë°›ê¸° ìœ„í•´ íŠ¹ì • ë„ë©”ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.
ê°€ë¹„ì•„ ê°™ì€ ë„ë©”ì¸ íŒë§¤ ì‚¬ì´íŠ¸ì—ì„œ ë„ë©”ì¸ì„ êµ¬ë§¤í•˜ê³ , EC2 ì¸ìŠ¤í„´ìŠ¤ì˜ IP ì£¼ì†Œì™€ ì—°ê²°í•©ë‹ˆë‹¤.

#### nginx ì„¤ì¹˜ ë° ì„¤ì •

EC2 ì¸ìŠ¤í„´ìŠ¤ì— nginxë¥¼ ì„¤ì¹˜í•œ í›„, Nginx ì„¤ì • íŒŒì¼ì—ì„œ ë„ë©”ì¸ ì´ë¦„ê³¼ ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ ì„¤ì •ì„ ì ìš©í•©ë‹ˆë‹¤.
ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œëŠ” í´ë¼ì´ì–¸íŠ¸ì˜ HTTPS ìš”ì²­ì„ ë°›ì•„ ë°±ì—”ë“œ ì„œë²„ë¡œ ì „ë‹¬í•©ë‹ˆë‹¤.

#### SSL/TLS ì¸ì¦ì„œ ë°œê¸‰

certbot ë„êµ¬ë¥¼ ì‚¬ìš©í•´ Let's Encrypt(CA ì¸ì¦ê¸°ê´€)ì—ì„œ SSL/TLS ì¸ì¦ì„œë¥¼ ë°œê¸‰ë°›ì•„ nginxì— ì ìš©í•©ë‹ˆë‹¤.
ì¸ì¦ì„œ ì„¤ì • í›„, í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ ê°„ì˜ ëª¨ë“  í†µì‹ ì´ HTTPSë¥¼ í†µí•´ ì•ˆì „í•˜ê²Œ ì•”í˜¸í™”ë©ë‹ˆë‹¤.
